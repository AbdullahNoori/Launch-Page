(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{116:function(e,t,n){"use strict";n.d(t,"a",function(){return s});var a=n(21),i=n(99),o=n(43),r=n(148);function s(e,t,n){var s;void 0===t&&(t=null),void 0===n&&(n=[]);var c=e.displayName||"";return c.startsWith("CerebralWrapping_")?(s=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Object(a.d)(n,t),n.prototype.render=function(){return o.React.createElement(o.CerebralContainer,{controller:i.a.getInstance(),strict:!0},o.React.createElement(e,Object(a.a)({},this.props)))},n}(o.React.PureComponent)).displayName="React2Angular_"+c:s=e,Object(r.react2angular)(s,t,n)}n.d(t,"b",function(){return r.react2angular})},123:function(e,t,n){"use strict";n.d(t,"k",function(){return l}),n.d(t,"h",function(){return u}),n.d(t,"d",function(){return f}),n.d(t,"i",function(){return h}),n.d(t,"g",function(){return m}),n.d(t,"f",function(){return b}),n.d(t,"a",function(){return g}),n.d(t,"b",function(){return v}),n.d(t,"e",function(){return x}),n.d(t,"j",function(){return y}),n.d(t,"c",function(){return _});var a=n(375),i=n(297),o=n.n(i),r=a.a(),s=document.createElement("a"),c="(?:(?:(?:[a-z]+:)?//)|www\\.)(?:\\S+(?::\\S*)?@)?(?:localhost|(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}(?:\\-{2}[a-z0-9]{4})?))\\.?)(?::\\d{2,5})?(?:[/?#](?:[^\\s'\":();]*[^\\s,'\":;.()])?)?",d=new RegExp("(?:^"+c+"$)","i"),l=new RegExp("("+c+")","ig"),p=new RegExp("(?:^(?:[a-z]+:\\/\\/)(?:[^\\s]+)$)","i"),u=new RegExp("("+c+")$");function f(e){return v()+"?moveToWidget="+r().getTokenizerHash(e.tokenizer)}function h(e){return g()+e}function m(e){return d.test(e)}function b(e){return p.test(e)}function g(){return location.protocol+"//"+location.host}function v(){return g()+location.pathname}var x=o()(function(e){return e.match(l)||[]});function y(e){(e=(e||"").trim()).startsWith("/")||-1===e.search(/^[a-z](?:[a-z\d+\-.])*:/i)&&(e=document.location.protocol+"//"+e);return s.href=e,s.href}function _(e){return s.href=y(e),s.hostname}},1494:function(e,t){e.exports="#img__close-16-in-24"},1495:function(e,t){e.exports="#img__icon-notes"},1496:function(e,t,n){"use strict";var a=n(21),i=n(43),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(a.d)(t,e),t.prototype.render=function(){return i.React.createElement("div",{className:"rtb-material-spinner","ng-style":"{'width': spinner.width}"},i.React.createElement("svg",{className:"rtb-material-spinner-circular",viewBox:"25 25 50 50"},i.React.createElement("circle",{className:"rtb-material-spinner-path","ng-style":"{'stroke': spinner.color, 'stroke-width': spinner.strokeWidth}",cx:"50",cy:"50",r:"20",fill:"none",strokeWidth:"2",strokeMiterlimit:"10"})))},t}(i.React.PureComponent);t.a=o},213:function(e,t,n){"use strict";var a;n.d(t,"a",function(){return a}),function(e){e.EDIT="EDIT",e.VIEW="VIEW",e.COMMENT="COMMENT",e.PRIVATE="PRIVATE"}(a||(a={}))},2175:function(e,t,n){e.exports=n.p+"src/lazy-modules/feed/components/feed-notifications-list/hand.e177c3.png"},2176:function(e,t,n){e.exports=n.p+"src/lazy-modules/feed/components/feed-empty-page/eye.4e79c2.png"},238:function(e,t,n){"use strict";var a=n(658);t.a=function(e,t){return t||(t=e),function(n){var i=n.input,o=n.state,r=n.output,s=o.get(e);a.a.setPathValue(i,t,s),r(i)}}},298:function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"d",function(){return o}),n.d(t,"c",function(){return r});var a=n(42),i="js-page-opener";function o(){return"OpenLinkService"}function r(){return a.a("OpenLinkService")}t.b=r()},300:function(e,t){e.exports="#img__3dots"},301:function(e,t,n){"use strict";function a(){}var i=function(e,t,n){void 0===t&&(t={isTrue:!0,isFalse:a}),void 0===n&&(n=!0);var i=function(i){var o=i.state,r=i.output,s=o.get(e);n&&s&&"object"===typeof s&&0===Object.keys(s).length&&(s=!1);var c=null,d=null;Object.keys(t).forEach(function(e){s==t[e]&&(c=e),t[e]==a&&(d=e)}),r[c||d]()};return i.displayName="when",i.outputs=Object.keys(t),i};i.otherwise=a,t.a=i},375:function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return o});var a=n(42);function i(){return"WidgetsHashService"}function o(){return a.a("WidgetsHashService")}},4692:function(e,t,n){var a=n(4693);"string"===typeof a&&(a=[[e.i,a,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(24)(a,i);a.locals&&(e.exports=a.locals)},4693:function(e,t,n){(e.exports=n(23)(!1)).push([e.i,".thread-comment-message {\n  font-size: 14px;\n  line-height: 1.43;\n  padding: 12px;\n}\n.thread-comment-message.thread-comment-message-tip {\n  display: -ms-flexbox;\n  display: flex;\n  font-size: 12px;\n  line-height: 1.5;\n  padding-bottom: 20px;\n}\n.thread-comment-message-tip__icon {\n  -ms-flex-negative: 0;\n      flex-shrink: 0;\n  width: 16px;\n  height: 16px;\n  margin-right: 8px;\n}\n.thread-comment-message-tip__close {\n  -ms-flex-negative: 0;\n      flex-shrink: 0;\n  width: 24px;\n  height: 24px;\n  margin-left: 12px;\n  opacity: 0.2;\n  cursor: pointer;\n}\n.thread-comment-message.thread-comment-message--new {\n  background-color: rgba(66, 98, 255, 0.06);\n  border-top-right-radius: 8px;\n  border-top-left-radius: 8px;\n}\n.thread-comment-message.thread-comment-message--new + .thread-comment-message.thread-comment-message--new {\n  border-top-right-radius: 0;\n  border-top-left-radius: 0;\n}\n.thread-comment-message.thread-comment-message--new:last-child {\n  border-bottom-right-radius: 8px;\n  border-bottom-left-radius: 8px;\n}\n.thread-comment-message-header {\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-direction: row;\n      flex-direction: row;\n  -ms-flex-align: center;\n      align-items: center;\n  margin-bottom: 4px;\n  -ms-flex-pack: justify;\n      justify-content: space-between;\n}\n.thread-comment-message-header-user-info {\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-align: center;\n      align-items: center;\n}\n.thread-comment-message-header-user-info__user-image {\n  width: 16px;\n  height: 16px;\n  border-radius: 50%;\n  margin-right: 5px;\n  background-color: #e1e0e7;\n}\n.thread-comment-message-header-user-info__user-name {\n  font-weight: bold;\n}\n.thread-comment-message-header__date {\n  font-size: 12px;\n  line-height: 1.67;\n  opacity: 0.4;\n  color: #050038;\n}\n.thread-comment-message__text {\n  padding-top: 6px;\n  word-break: break-word;\n  -webkit-user-select: text;\n     -moz-user-select: text;\n      -ms-user-select: text;\n          user-select: text;\n}\n",""])},4694:function(e,t,n){var a=n(4695);"string"===typeof a&&(a=[[e.i,a,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(24)(a,i);a.locals&&(e.exports=a.locals)},4695:function(e,t,n){(e.exports=n(23)(!1)).push([e.i,".thread-comment-body {\n  padding: 0px 20px;\n}\n",""])},4696:function(e,t){e.exports="#img__notification-bell-16"},4697:function(e,t,n){var a=n(4698);"string"===typeof a&&(a=[[e.i,a,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(24)(a,i);a.locals&&(e.exports=a.locals)},4698:function(e,t,n){(e.exports=n(23)(!1)).push([e.i,".thread-textarea {\n  width: 100%;\n  line-height: 20px;\n  color: #050038;\n  font-size: 14px;\n  resize: none;\n}\n",""])},4699:function(e,t){e.exports="#img__lock"},4700:function(e,t,n){var a=n(4701);"string"===typeof a&&(a=[[e.i,a,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(24)(a,i);a.locals&&(e.exports=a.locals)},4701:function(e,t,n){(e.exports=n(23)(!1)).push([e.i,".thread {\n  position: relative;\n  max-height: 100%;\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-direction: column;\n      flex-direction: column;\n}\n.thread-header {\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-negative: 0;\n      flex-shrink: 0;\n  padding: 0 24px 26px 32px;\n  margin-top: 15px;\n  cursor: pointer;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  font-family: Formular, sans-serif;\n  font-size: 18px;\n  font-weight: normal;\n}\n.thread-header:hover {\n  color: #4262ff;\n}\n.thread-header__icon {\n  height: 24px;\n  width: 23px;\n  margin-right: 12px;\n}\n.thread-body {\n  position: relative;\n  overflow-y: auto;\n  -webkit-overflow-scrolling: touch;\n  scrollbar-color: #9b99b0 transparent;\n  scrollbar-width: thin;\n}\n.thread-body::-webkit-scrollbar {\n  width: 4px;\n  height: 4px;\n}\n.thread-body::-webkit-scrollbar-thumb {\n  background-color: #9b99b0;\n  border: 0 solid transparent;\n  border-radius: 2px;\n}\n.thread-body::-webkit-scrollbar-track {\n  background-color: initial;\n}\n.thread-body.thread-body--with-preview .feed-message__wrapper {\n  top: 184px;\n}\n.thread-body__image {\n  width: 356px;\n  height: 200px;\n  margin: 0 0 10px 32px;\n  -o-object-fit: cover;\n     object-fit: cover;\n  box-sizing: border-box;\n  border-radius: 8px;\n  border: solid 1px #e1e0e7;\n  background-color: #f2f2f2;\n  filter: opacity(0.92) drop-shadow(0 0 0 #211f33);\n}\n.thread-body__image:hover {\n  border: solid 1px #9b99af;\n  cursor: pointer;\n}\n.thread-reply {\n  margin: 16px 32px 32px 32px;\n  border-radius: 4px;\n  border: solid 1px rgba(5, 0, 56, 0.2);\n  min-height: 40px;\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-direction: row;\n      flex-direction: row;\n  -ms-flex-align: center;\n      align-items: center;\n  padding: 0px 14px 0px 14px;\n  font-size: 14px;\n  line-height: 1.43;\n}\n.thread-reply__emoji-icon {\n  height: 24px;\n  width: 24px;\n  cursor: pointer;\n  margin-left: 24px;\n  opacity: 0.2;\n}\n.thread-reply__emoji-icon:hover {\n  opacity: 1;\n}\n.thread-mentions {\n  position: absolute;\n  left: 20px;\n  top: calc(100% - 24px);\n  z-index: 2;\n  width: 380px;\n  max-height: 33vh;\n  overflow-y: auto;\n  border-radius: 8px;\n  box-shadow: 0 4px 20px 0 rgba(0, 0, 0, 0.12);\n  background-color: #fff;\n  -webkit-overflow-scrolling: touch;\n  scrollbar-color: #9b99b0 transparent;\n  scrollbar-width: thin;\n}\n.thread-mentions::-webkit-scrollbar {\n  width: 4px;\n  height: 4px;\n}\n.thread-mentions::-webkit-scrollbar-thumb {\n  background-color: #9b99b0;\n  border: 0 solid transparent;\n  border-radius: 2px;\n}\n.thread-mentions::-webkit-scrollbar-track {\n  background-color: initial;\n}\n.thread-mentions.thread-mentions--top {\n  top: unset;\n  bottom: 82px;\n}\n.thread-mention {\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-align: center;\n      align-items: center;\n  white-space: nowrap;\n  width: 100%;\n  padding: 8px 16px;\n  line-height: 24px;\n  cursor: pointer;\n}\n.thread-mention:hover *,\n.thread-mention:focus *,\n.thread-mentions:not(:hover) .thread-mention.thread-mention--selected * {\n  color: #4262ff;\n}\n.thread-mention:hover .thread-mention__divider,\n.thread-mention:focus .thread-mention__divider,\n.thread-mentions:not(:hover) .thread-mention.thread-mention--selected .thread-mention__divider {\n  background-color: #4262ff;\n}\n.thread-mention:first-child {\n  padding-top: 16px;\n}\n.thread-mention:last-child {\n  padding-bottom: 16px;\n}\n.thread-mention--custom + .thread-mention--user {\n  margin-top: 8px;\n  padding-top: 16px;\n  border-top: solid 1px #e1e0e7;\n}\n.thread-mention__name,\n.thread-mention__email {\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.thread-mention__email {\n  -ms-flex-negative: 9;\n      flex-shrink: 9;\n  margin-left: 8px;\n  color: #827f9b;\n}\n.thread-mention__image {\n  width: 20px;\n  height: 20px;\n  border-radius: 10px;\n  margin-right: 12px;\n}\n.thread-mention__divider {\n  height: 14px;\n  width: 1px;\n  margin-left: 8px;\n  background-color: #c3c2cf;\n}\n.thread-action {\n  padding: 12px 32px;\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-align: stretch;\n      align-items: stretch;\n  color: #827f9b;\n}\n.thread-action__image {\n  -ms-flex-negative: 0;\n      flex-shrink: 0;\n  width: 16px;\n  height: 19px;\n  margin-right: 8px;\n  color: #827f9b;\n}\n",""])},4702:function(e,t){e.exports="#img__close-16"},4703:function(e,t){e.exports="#img__mention-16"},4704:function(e,t){e.exports="#img__comment-16"},4705:function(e,t){e.exports="#img__requests-16"},4706:function(e,t,n){e.exports=n.p+"src/lazy-modules/feed/components/feed-notifications-list/onboarding.4052ba.png"},4707:function(e,t,n){var a=n(4708);"string"===typeof a&&(a=[[e.i,a,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(24)(a,i);a.locals&&(e.exports=a.locals)},4708:function(e,t,n){(e.exports=n(23)(!1)).push([e.i,'.feed {\n  height: 100%;\n  color: #050038;\n  overflow: hidden;\n}\n.feed__inner {\n  width: 420px;\n  height: 100%;\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-direction: column;\n      flex-direction: column;\n  box-sizing: border-box;\n}\n.feed-header {\n  height: 72px;\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-align: center;\n      align-items: center;\n  -ms-flex-pack: justify;\n      justify-content: space-between;\n  -ms-flex-negative: 0;\n      flex-shrink: 0;\n  padding: 0 20px 0 32px;\n}\n.feed-header__back-button {\n  padding: 0;\n  font-family: Formular, sans-serif;\n  font-size: 24px;\n  font-weight: 500;\n  line-height: 28px;\n}\n.feed-header__back-button:hover {\n  color: #4262ff;\n}\n.feed-header__read-all-button {\n  padding: 0;\n  height: 24px;\n  margin-left: auto;\n  margin-right: 20px;\n}\n.feed-body {\n  height: calc(100% - 72px);\n}\n.feed-header__close-button {\n  cursor: pointer;\n  width: 24px;\n  height: 24px;\n}\n.feed-mode.rtb-select.rtb-select--secondary-flat .rtb-select__button {\n  font-family: Formular, sans-serif;\n  font-size: 24px;\n  font-weight: 500;\n  padding-left: 0;\n  line-height: 28px;\n  color: #050038;\n}\n.feed-mode.rtb-select.rtb-select--secondary-flat .rtb-select__options-wrapper {\n  left: -12px;\n  width: 200px;\n  box-sizing: border-box;\n  min-width: unset;\n}\n.feed-mode.rtb-select.rtb-select--secondary-flat .rtb-select__button:not([readonly])[is-active="true"] {\n  color: #4262ff;\n}\n.feed-mode.rtb-select.rtb-select--secondary-flat .rtb-select__option:hover:not([disabled]) {\n  color: #4262ff;\n}\n.feed-notifications-list {\n  position: relative;\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-direction: column;\n      flex-direction: column;\n  height: 100%;\n  overflow-y: scroll;\n  -webkit-overflow-scrolling: touch;\n  scrollbar-color: #9b99b0 transparent;\n  scrollbar-width: thin;\n}\n.feed-notifications-list::-webkit-scrollbar {\n  width: 4px;\n  height: 4px;\n}\n.feed-notifications-list::-webkit-scrollbar-thumb {\n  background-color: #9b99b0;\n  border: 0 solid transparent;\n  border-radius: 2px;\n}\n.feed-notifications-list::-webkit-scrollbar-track {\n  background-color: initial;\n}\n.feed-batch {\n  position: relative;\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-negative: 0;\n      flex-shrink: 0;\n  -ms-flex-direction: column;\n      flex-direction: column;\n  -ms-flex-align: center;\n      align-items: center;\n  margin: 10px 16px 0 32px;\n  transition: min-height 0.3s;\n}\n.feed-batch .feed-card:nth-child(1) {\n  margin-top: 8px;\n}\n.feed-batch + .feed-batch {\n  margin-top: 36px;\n}\n.feed-batch:last-child {\n  margin-bottom: 32px;\n}\n.feed-batch--collapsed .feed-card:nth-child(n + 3) .feed-card__read-button {\n  display: none;\n}\n.feed-batch--collapsed .feed-card:nth-child(3) {\n  position: absolute;\n  z-index: -1;\n  top: 40px;\n  transform: scaleX(0.96);\n}\n.feed-batch--collapsed .feed-card:nth-child(4) {\n  position: absolute;\n  z-index: -2;\n  top: 48px;\n  transform: scaleX(0.91);\n}\n.feed-batch--collapsed .feed-card:nth-child(n + 5) {\n  display: none;\n}\n.feed-batch--expanded .feed-batch__expand {\n  bottom: 0;\n}\n.feed-batch__expand {\n  display: inline-block;\n  height: 32px;\n  line-height: 32px;\n  padding: 0 15px;\n  border: solid 1px #cdccd7;\n  border-radius: 16px;\n  color: rgba(5, 0, 56, 0.4);\n  cursor: pointer;\n  transition: color 0.2s;\n}\n.feed-batch__expand:hover {\n  color: #050038;\n}\n.feed-batch-container {\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-negative: 0;\n      flex-shrink: 0;\n  -ms-flex-direction: column;\n      flex-direction: column;\n  -ms-flex-align: center;\n      align-items: center;\n  width: 100%;\n  padding-bottom: 24px;\n}\n.feed-batch--collapsed .feed-batch-container {\n  cursor: pointer;\n}\n.feed-card {\n  position: relative;\n  margin-top: 24px;\n  width: 100%;\n  background: #fff;\n}\n.feed-card__more-actions {\n  position: absolute;\n  top: 8px;\n  right: 8px;\n  height: 24px;\n  visibility: hidden;\n  border-radius: 3px;\n  padding: 0 3px;\n  background-color: rgba(5, 0, 56, 0.24);\n}\n.feed-card--clickable .feed-card__more-actions:hover,\n.feed-card--clickable .feed-card__more-actions:active,\n.feed-card--clickable .feed-card__more-actions.feed-more-actions--active {\n  visibility: visible;\n  background-color: rgba(5, 0, 56, 0.5);\n}\n.feed-card__more-actions svg {\n  color: #fff;\n  width: 24px;\n  height: 24px;\n}\n.feed-card:hover.feed-card--clickable .feed-card__more-actions {\n  visibility: visible;\n}\n.feed-card--fake {\n  box-shadow: none;\n  transition-property: box-shadow;\n  position: absolute;\n  border: solid 1px #cdccd7;\n  border-radius: 8px;\n  height: 110px;\n  box-sizing: border-box;\n  z-index: -1;\n  bottom: 16px;\n  width: calc(100% - 16px);\n  transition-property: top, width, bottom;\n  transition-duration: 0.15s;\n  background-color: #fff;\n}\n.feed-card--fake:hover {\n  box-shadow: 0 4px 16px 0 rgba(5, 0, 56, 0.08);\n}\n.feed-batch--collapsed .feed-batch-container:hover .feed-card--fake {\n  box-shadow: 0 4px 12px 0 rgba(5, 0, 56, 0.04);\n}\n.feed-batch-container:hover .feed-card--fake {\n  bottom: 14px;\n  box-shadow: 0 4px 12px 0 rgba(5, 0, 56, 0.06);\n}\n.feed-card--fake:nth-child(3) {\n  z-index: -2;\n  bottom: 8px;\n  width: calc(100% - 32px);\n}\n.feed-batch-container:hover .feed-card--fake:nth-child(3) {\n  bottom: 4px;\n  box-shadow: 0 4px 16px 0 rgba(5, 0, 56, 0.08);\n}\n.feed-card__read-button {\n  position: absolute;\n  left: -28px;\n  top: 15px;\n  padding: 8px;\n  cursor: pointer;\n}\n.feed-card__read-button.rtb-tooltip.rtb-tooltip--top::before {\n  left: 8px;\n  border-left-width: 0;\n  bottom: calc(100% + 10px);\n  border-top-width: 4px;\n}\n.feed-card__read-button.rtb-tooltip.rtb-tooltip--top::after {\n  content: attr(data-content);\n  left: 8px;\n  border-bottom-left-radius: 0;\n  white-space: nowrap;\n  padding: 9px 12px;\n  bottom: calc(100% + 14px);\n  line-height: 12px;\n  background-color: #000;\n  opacity: 0.8;\n}\n.feed-card__read-button.rtb-tooltip.rtb-tooltip--top:before,\n.feed-card__read-button.rtb-tooltip.rtb-tooltip--top:after {\n  animation: tooltips 300ms ease-out forwards;\n  transform: none;\n}\n@keyframes tooltips {\n  to {\n    opacity: 0.8;\n  }\n}\n.feed-card__read-button-inner {\n  height: 8px;\n  width: 8px;\n  box-sizing: border-box;\n  background-color: #4262ff;\n  border-radius: 4px;\n}\n.feed-card__read-button--read .feed-card__read-button-inner {\n  background-color: #fff;\n  border: 1px solid #cdccd7;\n}\n.feed-card-body {\n  border-radius: 8px;\n  border: solid 1px #cdccd7;\n  box-shadow: none;\n  transition-property: box-shadow;\n  transition-duration: 0.15s;\n  overflow: hidden;\n}\n.feed-card-body:hover {\n  box-shadow: 0 4px 16px 0 rgba(5, 0, 56, 0.08);\n}\n.feed-batch--collapsed .feed-batch-container:hover .feed-card-body {\n  box-shadow: 0 4px 12px 0 rgba(5, 0, 56, 0.04);\n}\n.feed-card--clickable .feed-card-body {\n  cursor: pointer;\n}\n.feed-card--clickable .feed-card-body:hover .feed-card-body__action-arrow {\n  padding-left: 2px;\n}\n.feed-card-header {\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-align: center;\n      align-items: center;\n  height: 32px;\n  width: 100%;\n}\n.feed-batch__more-actions {\n  margin: 7px 7px 0 7px;\n  padding: 0 3px;\n  visibility: hidden;\n  color: #c3c2cf;\n}\n.feed-batch__more-actions:hover,\n.feed-batch__more-actions:active,\n.feed-batch__more-actions.feed-more-actions--active {\n  visibility: visible;\n  color: #050038;\n}\n.feed-batch__more-actions svg {\n  width: 24px;\n  height: 24px;\n}\n.feed-card-header:hover .feed-batch__more-actions {\n  visibility: visible;\n}\n.feed-card-header__title {\n  font-family: Formular, sans-serif;\n  font-size: 18px;\n  font-weight: normal;\n  cursor: pointer;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.feed-card-header__title:hover {\n  color: #4262ff;\n}\n.feed-card-header__notifications {\n  display: -ms-flexbox;\n  display: flex;\n  margin-left: auto;\n}\n.feed-card-header__notification {\n  display: -ms-flexbox;\n  display: flex;\n}\n.feed-card-header__notification + .feed-card-header__notification {\n  margin-left: 10px;\n}\n.feed-card-header__notification-counter {\n  margin-left: 4px;\n  line-height: 16px;\n}\n.feed-card-header__notification-icon {\n  width: 20px;\n  height: 16px;\n}\n.feed-card-body__image {\n  width: 100%;\n  height: 140px;\n  -o-object-fit: cover;\n     object-fit: cover;\n  box-sizing: border-box;\n  border-bottom: solid 1px #cdccd7;\n  border-radius: 8px 8px 0 0;\n  background-color: #f2f2f2;\n  filter: opacity(0.92) drop-shadow(0 0 0 #211f33);\n}\n.feed-card-body__content {\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-direction: column;\n      flex-direction: column;\n  -ms-flex-pack: justify;\n      justify-content: space-between;\n  min-height: 102px;\n  padding: 12px 16px 16px 16px;\n  box-sizing: border-box;\n}\n.feed-card-body__message-author-avatar {\n  position: relative;\n  top: 2px;\n  width: 16px;\n  height: 16px;\n  background-color: #cdccd7;\n  border-radius: 8px;\n}\n.feed-card-body__message-author-name {\n  font-weight: bold;\n}\n.feed-card-body__message {\n  word-break: break-word;\n  max-height: 40px;\n  overflow: hidden;\n}\n.feed-card-body__footer {\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-pack: justify;\n      justify-content: space-between;\n  -ms-flex-align: center;\n      align-items: center;\n  margin-top: 16px;\n}\n.feed-card-body__actions {\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-align: stretch;\n      align-items: stretch;\n}\n.feed-card-body__actions.rtb-tooltip.rtb-tooltip--right::after {\n  left: calc(100% + 22px);\n  width: 200px;\n  content: attr(data-content);\n}\n.feed-card-body__actions.rtb-tooltip.rtb-tooltip--right::before {\n  right: calc(0em - 22px);\n}\n.feed-card-body__actions .rtb-btn--small.rtb-btn--primary-flat {\n  height: auto;\n  padding: 0;\n}\n.feed-card-body__action-span {\n  display: -ms-inline-flexbox;\n  display: inline-flex;\n  -ms-flex-align: end;\n      align-items: end;\n  margin-right: 14px;\n  color: #827f9b;\n  max-height: 38px;\n  overflow: hidden;\n}\n.feed-card-body__action-span-image {\n  -ms-flex-negative: 0;\n      flex-shrink: 0;\n  width: 16px;\n  height: 19px;\n  margin-right: 8px;\n}\n.feed-card-body__time {\n  -ms-flex-negative: 0;\n      flex-shrink: 0;\n  opacity: 0.4;\n}\n.feed-batch + .rtb-material-spinner {\n  margin: 44px auto 10px;\n}\n.feed-message {\n  position: absolute;\n  z-index: 1;\n  line-height: 32px;\n  border-radius: 16px;\n  -webkit-backdrop-filter: blur(4px);\n  backdrop-filter: blur(4px);\n  background-color: #000;\n  opacity: 0.8;\n  color: #fff;\n  font-weight: lighter;\n  padding: 0 16px;\n  font-family: inherit;\n  transition: opacity 0.2s;\n}\n.feed-message:hover {\n  opacity: 1;\n}\n.feed-message--button {\n  cursor: pointer;\n}\n.feed-message__wrapper {\n  position: absolute;\n  width: 100%;\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-pack: distribute;\n      justify-content: space-around;\n}\n.feed-loader {\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-align: center;\n      align-items: center;\n  -ms-flex-pack: center;\n      justify-content: center;\n  height: 100%;\n}\n.feed-info {\n  margin-bottom: 30px;\n  padding: 8px 32px 0;\n}\n.feed-info__image {\n  height: 48px;\n  margin-right: 12px;\n}\n.feed-info__heading {\n  display: inline-block;\n  position: relative;\n  top: -10px;\n  font-family: Formular, sans-serif;\n  font-size: 18px;\n  font-weight: normal;\n  line-height: 20px;\n}\n.feed-info__text {\n  margin-top: 2px;\n  line-height: 20px;\n}\n.feed-onboarding-image {\n  display: block;\n  width: 387px;\n  height: 456px;\n  margin: 8px 0 40px 16px;\n  background-color: #F3F4F8;\n  border-radius: 8px;\n}\n.feed-gray-text {\n  padding: 0 32px;\n  color: #827f9b;\n  text-align: center;\n}\n.feed__rating {\n  -ms-flex-negative: 0;\n      flex-shrink: 0;\n  margin: 16px 16px 0 32px;\n  overflow: hidden;\n  cursor: pointer;\n  border-radius: 8px;\n  border: solid 1px #cdccd7;\n  box-shadow: none;\n  transition-property: box-shadow;\n  transition-duration: 0.15s;\n}\n.feed__rating:hover {\n  box-shadow: 0 4px 16px 0 rgba(5, 0, 56, 0.08);\n}\n.feed-batch--collapsed .feed-batch-container:hover .feed__rating {\n  box-shadow: 0 4px 12px 0 rgba(5, 0, 56, 0.04);\n}\n.feed__rating .rate-comment-form {\n  border-top-color: #cdccd7;\n}\n.feed-card-border {\n  border-radius: 8px;\n  border: solid 1px #cdccd7;\n  box-shadow: none;\n  transition-property: box-shadow;\n  transition-duration: 0.15s;\n}\n.feed-card-border:hover {\n  box-shadow: 0 4px 16px 0 rgba(5, 0, 56, 0.08);\n}\n.feed-batch--collapsed .feed-batch-container:hover .feed-card-border {\n  box-shadow: 0 4px 12px 0 rgba(5, 0, 56, 0.04);\n}\n.feed-context-menu__wrapper {\n  position: relative;\n  width: 170px;\n  z-index: 1;\n}\n.feed-context-menu {\n  position: absolute;\n  padding: 8px 0 16px;\n  width: 170px;\n  background-color: #fff;\n  border-radius: 4px;\n  box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.12);\n}\n.feed-context-menu__action {\n  width: 100%;\n  text-align: left;\n  padding: 0 0 0 14px;\n  line-height: 36px;\n}\n.feed-context-menu__action:hover {\n  color: #4262ff;\n}\n.feed-context-menu__action.rtb-tooltip::after {\n  content: attr(data-content);\n  white-space: nowrap;\n}\n',""])},4709:function(e,t,n){e.exports='<div id="feed" class="feed use-ng-animate">\n    <div class="feed__inner">\n        <div class="feed-header">\n            <rtb-select ng-if="ctrl.page !== \'thread\'" class="feed-mode rtb-select--small rtb-select--secondary-flat" options="ctrl.modesOptions" ng-model="ctrl.mode"\n                        on-change="ctrl.onModeChanged(selectedOption)"></rtb-select>\n            <button ng-if="ctrl.showMarkAll()" class="feed-header__read-all-button rtb-link rtb-link--secondary-light rtb-link--dashed" hm-tap="ctrl.onClickReadAll()">Mark all as read</button>\n            <button ng-if="ctrl.page === \'thread\'" class="feed-header__back-button" hm-tap="ctrl.onClickBack()" ng-bind-html="ctrl.backButtonTitle"></button>\n            <svg  class="feed-header__close-button" hm-tap="ctrl.hide()"  ><use xlink:href="'+n(118)+'"></use></svg>\n        </div>\n        <div class="feed-body">\n            <feed-empty-page ng-if="ctrl.page === \'empty\'"></feed-empty-page>\n            <feed-notifications-list ng-show="ctrl.page === \'notifications\'"></feed-notifications-list>\n            <thread ng-if="ctrl.page === \'thread\'"></thread>\n            <div class="feed-loader" ng-if="ctrl.page === \'loader\'">\n                <material-spinner></material-spinner>\n            </div>\n        </div>\n    </div>\n</div>'},537:function(e,t){e.exports="#img__tick"},5555:function(e,t,n){"use strict";n.r(t);var a,i=n(30),o=n(21),r=n(54);!function(e){e.LOADER="loader",e.NOTIFICATIONS="notifications",e.THREAD="thread",e.EMPTY="empty"}(a||(a={}));var s,c=n(277),d=n(99),l=n(417);!function(e){e.BOARD_SHARED="BOARD_SHARED",e.ACCESS_REQUESTED="ACCESS_REQUESTED",e.COMMENT_ADDED="COMMENT_ADDED",e.USER_MENTIONED="USER_MENTIONED",e.THREAD="THREAD",e.BOARD="BOARD"}(s||(s={}));var p=s,u=n(87),f=function(e){function t(t,n,a){var i=e.call(this,t,a)||this;return i.signals=a,i.mode=Object(d.c)("ui.feed.mode"),i.modesOptions=[{key:"Unread",value:l.a.UNREAD},{key:"All updates",value:l.a.ALL}],i.signals.ui.feed.openFeed(Object(u.a)().rightSidebar.activePluginOptions),Object(c.a)().feedUpdated.add(i.processFeedUpdates,i),t.$on("$destroy",function(){Object(c.a)().feedUpdated.remove(i.processFeedUpdates,i)}),i.updateBackButtonTitle(),i}return Object(o.d)(t,e),t.prototype.processFeedUpdates=function(e){this.signals.ui.feed.processFeedUpdates(e.params)},t.prototype.showMarkAll=function(){return this.hasUnreadNotifications&&this.page===a.NOTIFICATIONS},t.prototype.hide=function(){this.signals.ui.feed.closeFeed({clickOn:"cross"})},t.prototype.updateMode=function(e){this.mode=e,this.updateBackButtonTitle()},t.prototype.onModeChanged=function(e){this.signals.ui.feed.changeFeedMode({mode:e.value})},t.prototype.onClickReadAll=function(){this.signals.ui.feed.markAllAsReadChain(),this.signals.ui.feed.sendFeedEvent({statEvent:"feed_item_clicked",statParams:{action:"feed_all_mark_as_read"}})},t.prototype.onClickBack=function(){this.signals.ui.feed.closeMentionsList(),this.signals.ui.feed.openFeedList(),this.signals.ui.feed.sendFeedEvent({statEvent:"feed_item_clicked",statParams:{action:"back_to_all",notification_type:p.THREAD}})},t.prototype.updateBackButtonTitle=function(){this.backButtonTitle='<span class="typo-formular">\u2190</span> Back to '+(this.mode===l.a.ALL?"All":"Unread")},t.prototype.checkCurrentAccount=function(e){void 0!==this.feedAccountId&&this.feedAccountId!==e&&this.signals.ui.feed.reloadFeedList()},t.$inject=["$scope","$element","signals"],Object(o.c)([Object(r.c)("ui.feed.page")],t.prototype,"page",void 0),Object(o.c)([Object(r.c)("ui.feed.hasUnreadNotifications")],t.prototype,"hasUnreadNotifications",void 0),Object(o.c)([Object(r.c)("ui.feed.currentAccountId")],t.prototype,"feedAccountId",void 0),Object(o.c)([Object(r.g)("ui.feed.mode")],t.prototype,"updateMode",null),Object(o.c)([Object(r.g)("app.currentAccountId")],t.prototype,"checkCurrentAccount",null),t}(r.a),h=n(25),m=n(116),b=n(43),g=(n(4692),n(180)),v=n(154);function x(e){var t=Date.now()-new Date(e).getTime(),n=Math.floor(t/6e4);if(n<1)return"Now";var a=Math.floor(n/60);if(a<1)return n+" min";var i=Math.floor(a/24);return i<1?a+" h":i+" d"}function y(e,t,n){var a=n>0?e.slice(0,n):[],i=n<e.length-1?e.slice(n+1):[];return Object(o.i)(a,[t],i)}function _(e){return e.type.name===p.THREAD}function E(e){return Array.isArray(e.data)?e.data.every(function(e){return!!e.read}):!!e.read}var w=function(e){function t(t){var n=e.call(this,t)||this;return n.state={age:""},n}return Object(o.d)(t,e),t.prototype.componentDidMount=function(){this.resetRefreshInterval()},t.prototype.render=function(){return b.React.createElement("div",{className:"feed-card-body__time"},this.state.age)},t.prototype.resetRefreshInterval=function(){this.setState({age:x(this.props.time)}),this.refreshIntervalHandler&&clearInterval(this.refreshIntervalHandler),this.refreshIntervalHandler=setInterval(this.minutesTick.bind(this),6e4)},t.prototype.minutesTick=function(){this.setState({age:x(this.props.time)})},t.prototype.componentWillUnmount=function(){clearInterval(this.refreshIntervalHandler)},t}(b.React.PureComponent),R=n(34),k=n(398),O=n(123),N="<a>@",S="</a>",T='<a href="$1" target="_blank" data-type="link" class="js-page-opener">$1</a>',A=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.creator=t.props.message.creator,t.time=t.props.message.edited,t.pictureUrl=t.creator.picture.small,t}return Object(o.d)(t,e),t.prototype.render=function(){var e=this.prepareViewText(),t=!(this.creator.id===Object(R.a)().userInfo.id)&&(!this.props.lastOpenTime||new Date(this.props.message.created)>new Date(this.props.lastOpenTime));return b.React.createElement("div",{className:"thread-comment-message "+(t?"thread-comment-message--new":"")},b.React.createElement("div",{className:"thread-comment-message-header"},b.React.createElement("div",{className:"thread-comment-message-header-user-info"},b.React.createElement("img",{className:"thread-comment-message-header-user-info__user-image",src:this.pictureUrl}),b.React.createElement("span",{className:"thread-comment-message-header-user-info__user-name"},this.creator.name)),b.React.createElement(w,{time:this.time})),b.React.createElement("div",{className:"thread-comment-message__text",key:this.props.message.id},e))},t.prototype.prepareViewText=function(){var e,t;return(e=this.props.message.text,t=this.props.message.mentions,Object(g.b)(e).split(k.d.mentions).filter(function(e){return!!e}).map(function(e){var n=e,a=!1;if(-1!=e.search(k.d.userMention)){var i=e.substring(2,e.length-1),o=t.find(function(e){return e.id===i});o&&(n=N+o.name+S,a=!0)}for(var r in k.b){var s=Object(k.c)(k.b[r]);-1!=e.search(s)&&(n=N+r+S,a=!0)}return{text:n,isHtml:a}}).map(function(e){return e.text.split(O.k).filter(function(e){return!!e}).map(function(t){var n=t,a=!1;return-1!=t.search(O.k)&&(n=T.replace(/\$1/g,t),a=!0),{text:n,isHtml:e.isHtml||a}})}).reduceRight(function(e,t){return t.concat.apply(t,e)},[])).map(function(e,t){if(e.isHtml)return b.React.createElement("span",{dangerouslySetInnerHTML:{__html:e.text},key:t});var n=Object(g.g)(e.text);return n.isHtml?b.React.createElement("span",{dangerouslySetInnerHTML:{__html:n.text},key:t}):n.text})},t}(b.React.Component);n(4694);var C=n(61);function M(){return C.b()}var j,I=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(o.d)(t,e),t.prototype.render=function(){var e=this,t=this.props.comment.messages.map(function(t){return b.React.createElement(A,{message:t,lastOpenTime:e.props.comment.lastOpenTime,key:t.id})});return b.React.createElement("div",{className:"thread-comment-body"},t,this.renderAutoFollowTip())},t.prototype.renderAutoFollowTip=function(){return this.props.showAutoFollowTip?b.React.createElement("div",{className:"thread-comment-message thread-comment-message-tip thread-comment-message--new"},b.React.createElement("svg",{className:"thread-comment-message-tip__icon"},b.React.createElement("use",{xlinkHref:n(4696)})),b.React.createElement("div",{className:"thread-comment-message-tip__text"},b.React.createElement("span",null,"You're following this thread and will get notified about new replies. "),b.React.createElement("a",{className:"rtb-link rtb-link--primary",href:"https://help.miro.com/hc/en-us/articles/360017730873-Comments",target:"_blank"},"Learn more")),b.React.createElement("svg",{className:"thread-comment-message-tip__close",onClick:this.hideAutoFollowTip},b.React.createElement("use",{xlinkHref:n(1494)}))):void 0},t.prototype.hideAutoFollowTip=function(){M().ui.feed.hideAutoFollowTip()},Object(o.c)([b.decorators.autobind],t.prototype,"hideAutoFollowTip",null),t}(b.React.PureComponent),D=(n(4697),n(58)),L=n(92),F=n(517),B=n(111),U=n.n(B),P=n(600),H=n(2091),z=U()(function(e,t,n,a){!function(e,t,n,a){G.getSuggestions(e,t,n,a).then(function(e){e.suggestions.forEach(function(e){e.id&&e.name&&q.setMention({id:e.id,name:e.name})}),M().ui.feed.openMentionsList({mentions:e})})}(e,t,n,a)},500),q=new H.a,G=new F.a(q);var V=/(\s@|^@)([^\s]*)$/,Y=function(e){function t(t){var n=e.call(this,t)||this;return n.indexToInsertMentionTo=-1,n.state={message:"",rows:1,maxRows:10},ee=n,n}return Object(o.d)(t,e),t.prototype.render=function(){return b.React.createElement("div",{className:"thread-reply"},b.React.createElement("textarea",{onKeyDown:this.onKeyDown,onChange:this.onChange,className:"thread-textarea",value:this.state.message,rows:this.state.rows,placeholder:"Leave a reply. Use @ to mention."}))},t.prototype.onChange=function(e){this.changeRowsCount(e),this.tryShowMentions()},t.prototype.changeRowsCount=function(e){if(e.target.value!==this.state.message){var t=this.state.maxRows,n=e.target.rows;e.target.rows=1;var a=~~(e.target.scrollHeight/20);a===n&&(e.target.rows=a),a>=t&&(e.target.rows=t,e.target.scrollTop=e.target.scrollHeight),this.setState({message:e.target.value,rows:a<t?a:t})}},t.prototype.onKeyDown=function(e){switch(e.which){case D.a.ENTER:if(this.props.mentionsList.visible)e.preventDefault(),this.props.onMentionPressEnter();else if(this.state.message&&!e.shiftKey){var t=(((n=this.state.message).match(k.d.parser)||[]).forEach(function(e){var t=P.c(e.substring(1,e.length)),a=q.getMentionByName(t);a&&"custom"!=a.id&&(n=n.replace(e,"@["+a.id+"]"))}),n);M().ui.feed.replyInThread({message:t}),this.setState({message:"",rows:1}),e.preventDefault()}break;case D.a.ESCAPE:this.hideMentions();break;case D.a.DOWN_ARROW:this.props.onPressDown(e);break;case D.a.UP_ARROW:this.props.onPressUp(e)}var n},t.prototype.tryShowMentions=function(){var e=this.state.message.substring(0,this.currentCursorPosition),t=e.match(V);if(t){var n=t[2];this.indexToKeepTextFrom=this.currentCursorPosition,this.indexToInsertMentionTo=e.lastIndexOf(n),this.props.onShowSuggestions(n)}else this.hideMentions()},t.prototype.hideMentions=function(){M().ui.feed.closeMentionsList()},t.prototype.onSuggestionClick=function(e){if(-1!==this.indexToInsertMentionTo){var t,n=(e.name||e.email).replace(new RegExp(" ","gmi"),"_"),a=this.state.message.substring(0,this.indexToInsertMentionTo),i=b.ReactDOM.findDOMNode(this);i instanceof HTMLElement&&(t=i.querySelector("textarea"),this.indexToKeepTextFrom=t.selectionStart);var o=""+a+n+" "+this.state.message.substring(this.indexToKeepTextFrom),r=this.indexToInsertMentionTo+n.length+1;this.setState({message:o}),this.hideMentions(),requestAnimationFrame(function(){t&&(t.focus(),t.selectionStart=r)})}},Object(o.c)([b.decorators.autobind],t.prototype,"onChange",null),Object(o.c)([b.decorators.autobind],t.prototype,"onKeyDown",null),Object(o.c)([b.decorators.debounce(100)],t.prototype,"tryShowMentions",null),Object(o.c)([b.decorators.autobind],t.prototype,"onSuggestionClick",null),t}(b.React.Component),W=n(131),$=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(o.d)(t,e),t.prototype.render=function(){var e=this;if(this.props.mentionsList.visible){var t=this.props.mentionsList.data.custom.length;return b.React.createElement("div",{className:"thread-mentions "+this.props.className,"no-prevent-default":"true"},this.props.mentionsList.data.custom.map(function(t,n){return b.React.createElement("button",{onClick:e.props.onSuggestionClick.bind(e,t),className:"thread-mention thread-mention--custom "+e.getFocusedClassName(n),key:t.name},b.React.createElement("span",{className:"thread-mention__name"},"@",t.displayName),b.React.createElement("span",{className:"thread-mention__divider"}),b.React.createElement("span",{className:"thread-mention__email"},t.email))}),this.props.mentionsList.data.suggestions.map(function(n,a){return b.React.createElement("button",{onClick:e.props.onSuggestionClick.bind(e,n),className:"thread-mention thread-mention--user "+e.getFocusedClassName(a+t),key:n.id},b.React.createElement("img",{className:"thread-mention__image",src:n.picture.size44}),b.React.createElement("span",{className:"thread-mention__name"},n.name),b.React.createElement("span",{className:"thread-mention__divider"}),b.React.createElement("span",{className:"thread-mention__email"},n.email))}))}return null},t.prototype.getFocusedClassName=function(e){return e===this.props.selectedMentionIdx?"thread-mention--selected":""},t}(b.React.Component),Q=n(298),K=n(52);function J(e,t){var n=e.data.filter(function(e){return e.isRead!==t}).map(function(e){return{accountId:e.context.account.id,boardId:e.context.board.id,notificationId:e.id,notification:e,newState:{isRead:t}}});M().ui.feed.changeNotificationReadState({notificationUpdateState:n})}function X(e){var t;t=e.document?""+window.location.origin+K.b.noteCommentLink(e.board.id,e.thread.threadId):""+window.location.origin+K.b.boardWidgetLink(e.board.id,e.thread.threadId),Object(Q.b)().open({url:t})}function Z(e,t){M().ui.feed.changeNotificationReadState({notificationUpdateState:[{notification:e,newState:{isRead:t||!e.isRead}}]})}var ee,te=function(e){function t(t){var n=e.call(this,t)||this;return n.state={ageInMinutes:0,selectedMentionIdx:0,mentionsPickerOnTop:!0,hasPreview:!!n.props.thread.parameters.preview},n.windowClickController=W.b(n,function(){return n.props.mentionsList.visible&&M().ui.feed.closeMentionsList(),!0},".thread-reply, .thread-mentions"),n}return Object(o.d)(t,e),t.prototype.componentDidMount=function(){this.resetRefreshInterval(),this.setReplyFocus(),this.initMentionsSources()},t.prototype.render=function(){var e=this;if(!this.props.thread)return"";var t=this.props.thread.parameters.preview;return b.React.createElement("div",{className:"thread"},b.React.createElement("div",{className:"thread-header",onClick:this.openBoard.bind(this,"title")},this.renderHeaderIcon(),b.React.createElement("span",null,this.props.thread.context.board.title)),b.React.createElement("div",{className:"thread-body "+(this.state.hasPreview?"thread-body--with-preview":""),"no-prevent-default":"true"},this.renderUpdateButton(),this.state.hasPreview?b.React.createElement("img",{className:"thread-body__image",src:t,onClick:this.openBoard.bind(this,"preview"),onError:function(t){return e.setState({hasPreview:!1})}}):null,b.React.createElement(I,{comment:this.props.thread.parameters.comment,showAutoFollowTip:this.props.showAutoFollowTip}),this.renderReply()),b.React.createElement($,{className:this.state.mentionsPickerOnTop?"thread-mentions--top":"",mentionsList:this.props.mentionsList,onSuggestionClick:this.onSuggestionClick,selectedMentionIdx:this.state.selectedMentionIdx}))},t.prototype.renderHeaderIcon=function(){return this.props.thread.context.document?b.React.createElement("svg",{className:"thread-header__icon"},b.React.createElement("use",{xlinkHref:n(1495)})):""},t.prototype.onSuggestionClick=function(e){ee.onSuggestionClick(e)},t.prototype.renderUpdateButton=function(){if(this.state.ageInMinutes>=2){var e="Last updated "+this.state.ageInMinutes+" min ago.";return b.React.createElement("div",{className:"feed-message__wrapper"},b.React.createElement("button",{className:"feed-message",onClick:this.reloadThread},b.React.createElement("span",null,e)," ",b.React.createElement("span",{className:"rtb-link"},"Refresh")))}return""},t.prototype.renderReply=function(){return void 0===this.props.thread.parameters.canReply||this.props.thread.parameters.canReply?this.props.thread.context.board.trashed||this.props.thread.parameters.comment.hidden?"":b.React.createElement(Y,{mentionsList:this.props.mentionsList,onShowSuggestions:this.showSuggestions,onPressDown:this.onPressDown,onPressUp:this.onPressUp,onMentionPressEnter:this.onMentionPressEnter}):this.props.thread.parameters.hasRequestAccess?b.React.createElement("div",{className:"thread-action"},b.React.createElement("svg",{className:"thread-action__image"},b.React.createElement("use",{xlinkHref:n(537)})),b.React.createElement("span",null,"Request has been sent. You\u2019ll be notified when you\u2019ll get you access to this board.")):b.React.createElement("div",{className:"thread-action"},b.React.createElement("svg",{className:"thread-action__image"},b.React.createElement("use",{xlinkHref:n(4699)})),b.React.createElement("div",null,b.React.createElement("div",null,b.React.createElement("span",null,"You have no access to this board")),b.React.createElement("div",null,b.React.createElement("a",{className:"rtb-link rtb-link--primary",onClick:this.requestAccess.bind(this,this.props.thread.context.board.id)},"Request access to reply"))))},t.prototype.reloadThread=function(){M().ui.feed.openThread({context:this.props.thread.context,notificationsCount:0,notificationId:this.props.thread.id}),M().ui.feed.sendFeedEvent({statEvent:"feed_item_clicked",statParams:{action:"refresh_thread",notification_type:p.THREAD}})},t.prototype.componentDidUpdate=function(e){this.checkThreadDidUpdate(e),this.checkMentionsDidUpdate(e)},t.prototype.checkThreadDidUpdate=function(e){e.thread&&this.props.thread&&(e.thread.id!==this.props.thread.id||e.thread.parameters.comment.lastOpenTime!==this.props.thread.parameters.comment.lastOpenTime)&&(this.resetRefreshInterval(),this.setReplyFocus(),this.initMentionsSources())},t.prototype.checkMentionsDidUpdate=function(e){(e.mentionsList.visible!==this.props.mentionsList.visible||e.mentionsList.data&&this.props.mentionsList.data&&e.mentionsList.data&&e.mentionsList.data.allCount!==this.props.mentionsList.data.allCount)&&(this.props.mentionsList.data&&this.state.selectedMentionIdx>this.props.mentionsList.data.allCount-1&&this.setState({selectedMentionIdx:0}),this.updateMentionPickerPosition())},t.prototype.updateMentionPickerPosition=function(){var e=b.ReactDOM.findDOMNode(this);if(e instanceof HTMLElement){var t=e.querySelector(".thread-mentions"),n=e.querySelector(".thread-reply");if(t){n.offsetTop+72+51<t.offsetHeight?this.setState({mentionsPickerOnTop:!1}):this.setState({mentionsPickerOnTop:!0})}}},t.prototype.resetRefreshInterval=function(){this.setState({ageInMinutes:0}),this.refreshIntervalHandler&&clearInterval(this.refreshIntervalHandler),this.refreshIntervalHandler=setInterval(this.minutesTick.bind(this),6e4)},t.prototype.setReplyFocus=function(){var e=b.ReactDOM.findDOMNode(this);if(e instanceof HTMLElement){var t=e.querySelector(".thread-reply");t&&(t.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"}),setTimeout(function(){e.querySelector(".thread-textarea").focus()},500))}},t.prototype.minutesTick=function(){this.setState({ageInMinutes:this.state.ageInMinutes+1})},t.prototype.componentWillUnmount=function(){clearInterval(this.refreshIntervalHandler),this.windowClickController.destroy()},t.prototype.openBoard=function(e){X(this.props.thread.context),M().ui.feed.sendFeedEvent({statEvent:"feed_item_clicked",statParams:{action:"title"===e?"open_board_title":"open_board_preview",notification_type:p.THREAD}})},t.prototype.initMentionsSources=function(){(void 0==this.props.thread.parameters.canReply||this.props.thread.parameters.canReply)&&function(e){var t=Object(R.a)().myUserId;j=t&&t.toString()||"",G.initSourcesByBoardId(e),q.resetMentions()}(this.props.thread.context.board.id)},t.prototype.showSuggestions=function(e){!function(e,t){Object(R.a)().userType!==L.a.REGULAR?M().ui.feed.openMentionsList({mentions:{result:[],custom:[]}}):z(e,!0,function(e){var t=e.data.filter(function(e){return e.id!==j});return Promise.resolve(t)},t)}(e,this.props.thread.parameters.comment)},t.prototype.onPressDown=function(e){this.props.mentionsList.visible&&e.preventDefault();var t=this.state.selectedMentionIdx+1;t>this.props.mentionsList.data.allCount-1&&(t=0),this.setState({selectedMentionIdx:t})},t.prototype.onPressUp=function(e){this.props.mentionsList.visible&&e.preventDefault();var t=this.state.selectedMentionIdx-1;t<0&&(t=this.props.mentionsList.data.allCount-1),this.setState({selectedMentionIdx:t})},t.prototype.onMentionPressEnter=function(){var e,t=this.state.selectedMentionIdx,n=this.props.mentionsList.data;t>n.custom.length-1?(t-=n.custom.length,e=n.suggestions[t]):e=n.custom[t],e&&this.onSuggestionClick(e)},t.prototype.requestAccess=function(e){M().ui.feed.requestBoardAccess({boardId:e})},Object(o.c)([b.decorators.autobind],t.prototype,"reloadThread",null),Object(o.c)([b.decorators.autobind],t.prototype,"openBoard",null),Object(o.c)([b.decorators.autobind],t.prototype,"showSuggestions",null),Object(o.c)([b.decorators.autobind],t.prototype,"onPressDown",null),Object(o.c)([b.decorators.autobind],t.prototype,"onPressUp",null),Object(o.c)([b.decorators.autobind],t.prototype,"onMentionPressEnter",null),Object(o.c)([b.decorators.autobind],t.prototype,"requestAccess",null),t}(b.React.PureComponent);var ne,ae=function(){n(4700),Object(h.b)().component("thread",Object(m.a)(Object(b.cerebralConnect)({thread:"ui.feed.activeThread",mentionsList:"ui.feed.mentionsList",showAutoFollowTip:"ui.feed.showAutoFollowTip"},te)))},ie=n(1496),oe=function(e){function t(t){var n=e.call(this,t)||this;return n.state={hasPreview:!!t.notification.parameters.preview},n}return Object(o.d)(t,e),t.prototype.render=function(){var e,t,a,i=this,o=this.props.notification,r=o.isRead;if(_(o)){var s=o.data[0];e=s.initiator,t=s.message,a=s.created}else e=o.initiator,a=o.created;var c=o.parameters.preview,d=this.isCardClickable(o);return b.React.createElement("div",{className:"feed-card "+(d?"feed-card--clickable":""),key:o.id},b.React.createElement("div",{className:"feed-card__read-button rtb-tooltip rtb-tooltip--top "+(r?"feed-card__read-button--read":""),onClick:this.toggleNotificationReadState.bind(this,o,"dot"),"data-content":(this.props.isBatchMode?"Mark all ":"Mark ")+(r?"as unread":"as read")},b.React.createElement("div",{className:"feed-card__read-button-inner"})),b.React.createElement("div",{className:"feed-card-body",onClick:this.clickCardBody.bind(this,o)},this.state.hasPreview?b.React.createElement("img",{className:"feed-card-body__image",src:c,onError:function(e){return i.setState({hasPreview:!1})}}):null,b.React.createElement("div",{className:"feed-card-body__content"},b.React.createElement("div",{className:"feed-card-body__message"},b.React.createElement("span",{className:"feed-card-body__message-author"},b.React.createElement("img",{className:"feed-card-body__message-author-avatar",src:e.picture.small}),"\xa0",b.React.createElement("span",{className:"feed-card-body__message-author-name"},e.name)),this.renderMessageText(o,e,t)),b.React.createElement("div",{className:"feed-card-body__footer"},this.renderActions(o),b.React.createElement(w,{time:a}))),b.React.createElement("button",{className:"feed-card__more-actions feed-more-actions",onClick:this.props.onMoreActionsClick},b.React.createElement("svg",null,b.React.createElement("use",{xlinkHref:n(300)})))))},t.prototype.isCardClickable=function(e){return!this.props.isBatchMode&&_(e)},t.prototype.renderMessageText=function(e,t,n){var a;switch(e.type.name){case p.BOARD_SHARED:a="invited you to "+e.parameters.sharingLevel+" "+e.context.board.title;break;case p.ACCESS_REQUESTED:a=this.isAccountRequest(e)?"requests access to your team and board "+e.context.board.title:"requests access to edit "+e.context.board.title;break;case p.THREAD:a=n,e.context.document&&(a=" mentioned in Note: <br/>"+a)}return a=this.cropText(a,t.name.length),b.React.createElement("span",{className:"feed-card-body__message-text",dangerouslySetInnerHTML:{__html:" "+a}})},t.prototype.renderActions=function(e){var t;if(this.props.isBatchMode)t=b.React.createElement("div",{className:"feed-card-body__actions"},b.React.createElement("span",{className:"feed-card-body__action-span"},b.React.createElement("span",null,"Show ",this.props.batchSize&&this.props.batchSize>=2?this.props.batchSize-1:"all"," updates"," ",b.React.createElement("span",{className:"typo-formular"},"\u2193"))));else switch(e.type.name){case p.BOARD_SHARED:t=b.React.createElement("div",{className:"feed-card-body__actions"},b.React.createElement("button",{className:"rtb-btn rtb-btn--small rtb-btn--primary",onClick:this.runCardPrimaryAction.bind(this,e)},"Go to board"));break;case p.ACCESS_REQUESTED:if(e.reaction){var a="Request approved",i=e.reaction.actor;i&&i.id!==Object(R.a)().userInfo.id&&(a+=" by "+i.name+" ("+i.email+")"),t=b.React.createElement("div",{className:"feed-card-body__actions"},b.React.createElement("span",{className:"feed-card-body__action-span"},b.React.createElement("svg",{className:"feed-card-body__action-span-image"},b.React.createElement("use",{xlinkHref:n(537)})),b.React.createElement("span",null,a)))}else t=e.isRead||void 0!==e.changeDate?b.React.createElement("div",{className:"feed-card-body__actions"},b.React.createElement("span",{className:"feed-card-body__action-span"},"Request ignored"),b.React.createElement("button",{className:"rtb-btn rtb-btn--small rtb-btn--primary-flat",onClick:this.runCardPrimaryAction.bind(this,e)},this.isAccountRequest(e)?"Give access":"Give edit access")):b.React.createElement("div",{className:"feed-card-body__actions"},b.React.createElement("button",{className:"rtb-btn rtb-btn--small rtb-btn--primary",onClick:this.runCardPrimaryAction.bind(this,e)},this.isAccountRequest(e)?"Give access":"Give edit access"),b.React.createElement("button",{className:"rtb-btn rtb-btn--small rtb-btn--secondary",onClick:this.runCardSecondaryAction.bind(this,e)},"Ignore"));break;case p.THREAD:var o=e.statistics.notificationsCount;t=b.React.createElement("div",{className:"feed-card-body__actions "+(this.props.showThreadHint?"rtb-tooltip rtb-tooltip--right rtb-tooltip--hover":""),"data-content":"Click on card to reply without opening a board"},b.React.createElement("span",{className:"rtb-btn rtb-btn--primary-flat rtb-btn--small"},1===o?"Reply in thread ":o+" new in thread ",b.React.createElement("span",{className:"feed-card-body__action-arrow typo-formular"},"\u2192")))}return t},t.prototype.toggleNotificationReadState=function(e,t,n){if(n.stopPropagation(),this.props.isBatchMode){var a=this.props.batch.data.every(function(e){return!!e.isRead});J(this.props.batch,!a)}else Z(e);M().ui.feed.sendFeedNotificationEvent({statEvent:"feed_mark_as_read_unread_clicked",notification:e,statParams:{type:e.isRead?"unread":"read",medium:t}})},t.prototype.clickCardBody=function(e){this.isCardClickable(e)&&_(e)&&this.runCardPrimaryAction(e)},t.prototype.runCardPrimaryAction=function(e){_(e)?function(e){M().ui.feed.openThread({context:e.context,notificationsCount:e.statistics.notificationsCount,notificationId:e.id}),M().ui.feed.sendFeedEvent({statEvent:"feed_item_clicked",statParams:{action:"reply_in_thread",notification_type:e.type.name}})}(e):e.type.name===p.BOARD_SHARED?(Z(e,!0),Object(Q.b)().open({url:K.b.boardLink(e.context.board.id)}),M().ui.feed.sendFeedEvent({statEvent:"feed_item_clicked",statParams:{action:"go_to_board",notification_type:e.type.name}})):e.type.name===p.ACCESS_REQUESTED&&(M().ui.feed.acceptBoardAccess({notification:e}),M().ui.feed.sendFeedEvent({statEvent:"feed_item_clicked",statParams:{action:"approve",notification_type:e.type.name}}))},t.prototype.runCardSecondaryAction=function(e){switch(e.type.name){case p.ACCESS_REQUESTED:Z(e,!0),M().ui.feed.sendFeedEvent({statEvent:"feed_item_clicked",statParams:{action:"ignore",notification_type:e.type.name}})}},t.prototype.cropText=function(e,t){var n=75-t,a=e;if(e.length>n){var i=(a=e.substring(0,n)).lastIndexOf(" ");i>0&&(a=a.substring(0,i)),a+="..."}return a},t.prototype.isAccountRequest=function(e){return void 0!==e.parameters.hasAccessToAccount&&!e.parameters.hasAccessToAccount},t}(b.React.PureComponent),re=n(50),se=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={closed:!1,showMore:!1,options:[],comment:""},t}return Object(o.d)(t,e),t.prototype.componentDidMount=function(){var e=this,t=this.props.options.slice();t.filter(function(t){return t.value===e.props.rate.value}).forEach(function(e){return e.checked=!0}),this.setState({options:t}),this.setState({rating:this.state.options.find(function(e){return e.checked})})},t.prototype.render=function(){return b.React.createElement("div",{className:"rate "+(this.props.showGratitude?"rate-float--gratitude":"")},b.React.createElement("div",{className:"rate-value"},b.React.createElement("div",{className:"rate-head"},b.React.createElement("h1",{className:"rate-caption"},this.header),b.React.createElement("button",{className:"rate-close",onClick:this.closed},b.React.createElement("svg",{className:"rate-close__cross"},b.React.createElement("use",{xlinkHref:n(4702)})))),this.renderOptions()),this.renderForm(),this.renderCloseBar())},t.prototype.renderForm=function(){return this.state.showMore&&!this.props.showGratitude?b.React.createElement("form",{name:"rate-form",className:"rate-comment-form",onSubmit:this.submit,encType:"application/x-www-form-urlencoded"},b.React.createElement("div",{className:"rate-input-wrapper","no-prevent-default":"true"},b.React.createElement("textarea",{value:this.state.comment,rows:1,placeholder:"Share your thoughts...",onInput:this.onInput,onChange:this.onCommentChange})),b.React.createElement("div",null,b.React.createElement("button",{name:"template-rate-submit-button",className:"rtb-btn rtb-btn--primary rtb-btn--mini",type:"submit","no-prevent-ios-touchstart":"true"},"Send"))):void 0},t.prototype.renderCloseBar=function(){return this.props.showGratitude?b.React.createElement("div",{className:"use-ng-animate rate-closebar rate-closebar--countdown"}):void 0},Object.defineProperty(t.prototype,"header",{get:function(){return this.props.showGratitude?"Thank you!":this.props.header},enumerable:!0,configurable:!0}),t.prototype.renderOptions=function(){var e=this;return this.props.showGratitude?void 0:b.React.createElement("div",{className:"rates"},this.state.options.map(function(t,n){var a="rate-option rate-option--"+t.className+" "+(t.value==e.state.ratingValue?"rate-option--checked":"");return b.React.createElement("label",{key:n,className:a,title:t.text},b.React.createElement("span",{className:"rate-option-ico"}),b.React.createElement("input",{type:"radio",value:t.value,checked:t.checked,onChange:e.onRateChange}))}))},t.prototype.onInput=function(e){Object(re.f)(e.target,this.baseScrollHeight)},t.prototype.onCommentChange=function(e){this.setState({comment:e.target.value})},t.prototype.onRateChange=function(e){var t=this;this.setState({ratingValue:e.target.value,showMore:!0}),setTimeout(function(){var e=b.ReactDOM.findDOMNode(t);if(e instanceof HTMLElement){var n=e.querySelector(".rate-input-wrapper textarea");n&&(t.baseScrollHeight=n.scrollHeight,n.focus())}},20)},t.prototype.closed=function(){this.props.closed()},t.prototype.submit=function(e){e.preventDefault(),e.stopPropagation(),this.props.rate.value=this.state.ratingValue,this.props.rate.comment=this.state.comment,this.props.submitted()},Object(o.c)([b.decorators.autobind],t.prototype,"onInput",null),Object(o.c)([b.decorators.autobind],t.prototype,"onCommentChange",null),Object(o.c)([b.decorators.autobind],t.prototype,"onRateChange",null),Object(o.c)([b.decorators.autobind],t.prototype,"closed",null),Object(o.c)([b.decorators.autobind],t.prototype,"submit",null),t}(b.React.PureComponent),ce=n(722),de=n(60),le=function(){function e(){this.value=void 0,this.comment=""}return e.prototype.getCaption=function(){return"Rate your experience with Feed"},e.prototype.getParams=function(){return{type:"feed",value:this.value,comment:this.comment}},e.prototype.getAchievementName=function(){return de.a.FEED_RATED_FIRST_TIME},e}(),pe=n(320),ue=n(33),fe=n(117);var he=[{id:"mark_as_read",getTitle:function(e){return e.isRead?"Mark as unread":"Mark as read"},handler:function(e){Z(e)}},{id:"go_to",title:"Go to board",handler:function(e){Object(Q.b)().open({url:K.b.boardLink(e.context.board.id)})}},{id:"remind_later",title:"Remind later",comingSoon:!0}];function me(e){return Object(ue.wb)(e.parameters.subscriptionMode)||e.data.some(function(e){return Object(ue.wb)(e.parameters.subscriptionMode)})}var be=((ne={})[p.BOARD]=[{id:"mark_all_as_read",getTitle:function(e){return e.data.every(function(e){return!!e.isRead})?"Mark all as unread":"Mark all as read"},handler:function(e){var t=e.data.every(function(e){return!!e.isRead});J(e,!t)}},{id:"go_to",title:"Go to board",handler:function(e){Object(Q.b)().open({url:K.b.boardLink(e.context.board.id)})}},{id:"unfollow",getTitle:function(e){return me(e)?"Unfollow all threads":"Follow all threads"},handler:function(e,t){var n=me(e)?pe.a.MANUALLY_UNSUBSCRIBED:pe.a.MANUALLY_SUBSCRIBED;M().ui.feed.changeBoardFollowState({board:e,subscriptionMode:n}),n===pe.a.MANUALLY_SUBSCRIBED?t.showTemporaryMessage({html:"You\u2019ll get notified about new replies on board",type:"message"}):t.showTemporaryMessage({html:'<span>\n\t\t\t\t\tYou won\'t get notified about replies on board. \n\t\t\t\t\t<span class="rtb-link">Undo</span>\n\t\t\t\t</span>',type:"message",clickCallback:function(n){n.target.classList.contains("rtb-link")&&(M().ui.feed.changeBoardFollowState({board:e,subscriptionMode:pe.a.MANUALLY_SUBSCRIBED}),t.showTemporaryMessage({html:"You\u2019ll get notified about new replies on board",type:"message"}))}})}},{id:"promote",title:"Promote this board",comingSoon:!0}],ne[p.THREAD]=[{id:"mark_as_read",getTitle:function(e){return e.isRead?"Mark as unread":"Mark as read"},handler:function(e){Z(e)}},{id:"go_to",title:"Go to comment",handler:function(e){return X(e.context)}},{id:"unfollow",getTitle:function(e){return Object(ue.wb)(e.parameters.subscriptionMode)?"Unfollow thread":"Follow thread"},handler:function(e,t){var n=Object(ue.wb)(e.parameters.subscriptionMode)?pe.a.MANUALLY_UNSUBSCRIBED:pe.a.MANUALLY_SUBSCRIBED;M().ui.feed.changeThreadFollowState({notification:e,subscriptionMode:n}),n===pe.a.MANUALLY_SUBSCRIBED?t.showTemporaryMessage({html:"You'll get notified about new replies in this thread",type:"message"}):t.showTemporaryMessage({html:'<span>\n\t\t\t\t\tYou won\'t get notified about this thread. \n\t\t\t\t\t<span class="rtb-link">Undo</span>\n\t\t\t\t</span>',type:"message",clickCallback:function(n){n.target.classList.contains("rtb-link")&&(M().ui.feed.changeThreadFollowState({notification:e,subscriptionMode:pe.a.MANUALLY_SUBSCRIBED}),t.showTemporaryMessage({html:"You'll get notified about new replies in this thread",type:"message"}))}})}},{id:"remind_later",title:"Remind later",comingSoon:!0}],ne[p.BOARD_SHARED]=he,ne[p.ACCESS_REQUESTED]=he,ne),ge={visible:!1,type:p.BOARD,position:{top:0,left:0,right:0},actions:[],context:void 0},ve=n(4703),xe=n(4704),ye=n(4705),_e=function(e){function t(t){var n=e.call(this,t)||this;return n.state={rate:new le,contextMenu:ge,message:void 0,isThreadSubscriptionsAvailable:!1},n.setThreadSubscriptionsAvailability(),n.windowClickController=W.b(n,n.closeContextMenu,".feed-more-actions, .feed-context-menu"),n}return Object(o.d)(t,e),t.prototype.tryLoadMoreNotifications=function(e){this.props.hasMoreNotifications&&!this.props.showListLoader&&(e.target.scrollHeight-e.target.offsetHeight-e.target.scrollTop<200&&M().ui.feed.loadMoreNotifications())},t.prototype.render=function(){var e=this;return b.React.createElement("div",{className:"feed-notifications-list","no-prevent-default":"true",onScroll:this.onScroll},this.renderContextMenu(),this.renderFirstTimeGreeting(),this.renderTodayGreeting(),this.renderEmptyState(),this.renderRating(),this.renderMessage(),this.props.notifications.map(function(t,a){var i=t.collapsed?"feed-batch--collapsed":t.data.length>1?"feed-batch--expanded":"",o=e.props.firstTimeGreetingVisible&&0===a;return b.React.createElement("div",{key:t.id,className:"feed-batch "+i},b.React.createElement("div",{className:"feed-card-header"},b.React.createElement("div",{className:"feed-card-header__title",onClick:e.openBoard.bind(e,t.context.board.id)},t.context.board.title),b.React.createElement("button",{className:"feed-batch__more-actions feed-more-actions",onClick:e.clickBoardActions.bind(e,t)},b.React.createElement("svg",null,b.React.createElement("use",{xlinkHref:n(300)}))),e.renderBatchStatistics(t)),e.renderNotifications(t,o),e.renderExpander(t))}),this.renderSpinner())},t.prototype.clickBoardActions=function(e,t){this.state.contextMenu.visible&&e===this.state.contextMenu.context?this.closeContextMenu():this.showMoreActions(p.BOARD,t.target,e)},t.prototype.clickCardActions=function(e,t){t.stopPropagation(),this.state.contextMenu.visible&&e===this.state.contextMenu.context?this.closeContextMenu():this.showMoreActions(e.type.name,t.target,e)},t.prototype.resetActiveContextMenuButton=function(){void 0!==this.activeContextMenuButton&&(this.activeContextMenuButton.classList.remove("feed-more-actions--active"),this.activeContextMenuButton=void 0)},t.prototype.showMoreActions=function(e,t,n){for(var a,i=t;!(i instanceof HTMLButtonElement)&&i.parentElement;)i=i.parentElement;this.resetActiveContextMenuButton(),this.activeContextMenuButton=i,this.activeContextMenuButton.classList.add("feed-more-actions--active");var o=this.getContextMenuTop(i);switch(e){case p.BOARD:var r=i.offsetLeft+32;a={top:o,left:Math.min(r,222)};break;default:a={top:o,left:222}}this.setState({contextMenu:{type:e,visible:!0,actions:this.getContextMenuConfig(e,n),position:a,context:n}})},t.prototype.getContextMenuConfig=function(e,t){var n=this;return be[e].map(function(e){var a={id:e.id,title:e.title,handler:e.handler,comingSoon:e.comingSoon};return e.getTitle&&(a.title=e.getTitle(t)),"unfollow"!==a.id||n.state.isThreadSubscriptionsAvailable||(a.comingSoon=!0),a})},t.prototype.getContextMenuTop=function(e){for(var t=e,n=t.offsetHeight+4;!t.className.includes("feed-notifications-list");)n+=t.offsetTop,t=t.offsetParent;return n},t.prototype.renderContextMenu=function(){var e=this,t=this.state.contextMenu;return t.visible&&t.position?b.React.createElement("div",{className:"feed-context-menu__wrapper",style:t.position},b.React.createElement("div",{className:"feed-context-menu"},t.actions.map(function(n,a){return b.React.createElement("button",{key:a,className:"feed-context-menu__action "+(n.comingSoon&&n.tipVisible?"rtb-tooltip rtb-tooltip--hover rtb-tooltip--top":""),onClick:e.runAction.bind(e,n,t.context),"data-content":n.comingSoon?"Coming soon!":""},n.title)}))):void 0},t.prototype.runAction=function(e,t){var n=this;e.comingSoon?(this.toggleActionTip(e,!0),setTimeout(function(){n.toggleActionTip(e,!1)},2e3)):(e.handler(t,this),this.closeContextMenu()),this.state.contextMenu.type===p.BOARD?M().ui.feed.sendFeedBatchEvent({statEvent:"feed_menu_item_clicked",batch:t,statParams:{level:"board",action:e.id}}):M().ui.feed.sendFeedNotificationEvent({statEvent:"feed_menu_item_clicked",notification:t,statParams:{level:"notification",action:e.id}})},t.prototype.toggleActionTip=function(e,t){var n=this.state.contextMenu.actions.map(function(n){var a=Object(o.a)({},n);return a.title===e.title?a.tipVisible=t:t&&delete a.tipVisible,a});this.setState({contextMenu:Object.assign({},this.state.contextMenu,{actions:n})})},t.prototype.closeContextMenu=function(){return this.setState({contextMenu:ge}),this.resetActiveContextMenuButton(),!0},t.prototype.renderRating=function(){return this.props.showRateRequest?b.React.createElement("div",{className:"feed__rating"},b.React.createElement(se,{header:this.state.rate.getCaption(),options:Object(ce.a)(),showGratitude:!1,rate:this.state.rate,submitted:this.onRatingSubmitted,closed:this.onRatingClosed})):void 0},t.prototype.onRatingClosed=function(){M().ui.feed.closeRating()},t.prototype.onRatingSubmitted=function(){this.showTemporaryMessage({html:"Thanks for your feedback!",type:"message"}),M().ui.feed.submitRating({params:this.state.rate.getParams()})},t.prototype.renderFirstTimeGreeting=function(){if(this.props.firstTimeGreetingVisible){var e="You'll be able to see @mentions and comments from your boards and reply to them here";return 0!==this.props.notifications.length||this.props.hasMoreNotifications?e+=".":e+=" \u2014 see example below:",b.React.createElement("div",{className:"feed-info"},b.React.createElement("div",{className:"feed-info__header"},b.React.createElement("img",{className:"feed-info__image",src:n(2175)}),b.React.createElement("div",{className:"feed-info__heading"},"Hey, ",Object(R.a)().userInfo.name,"!")),b.React.createElement("div",{className:"feed-info__text"},e))}return""},t.prototype.renderTodayGreeting=function(){return!this.props.firstTimeGreetingVisible&&this.props.todayGreetingVisible?b.React.createElement("div",{className:"feed-info"},b.React.createElement("div",{className:"feed-info__header"},b.React.createElement("img",{className:"feed-info__image",src:n(2175)}),b.React.createElement("div",{className:"feed-info__heading"},"Hey, ",Object(R.a)().userInfo.name,"!")),b.React.createElement("div",{className:"feed-info__text"},"Check out fresh updates from your team!")):""},t.prototype.renderEmptyState=function(){return 0!==this.props.notifications.length||this.props.hasMoreNotifications?"":b.React.createElement("div",null,b.React.createElement("img",{className:"feed-onboarding-image",src:n(4706)}),b.React.createElement("div",{className:"feed-gray-text"},"You don\u2019t have any notifications yet.",b.React.createElement("br",null),"@mention someone from your team on a board and check for updates here."))},t.prototype.toggleCollapsed=function(e){M().ui.feed.toggleBulkNotification({bulkNotification:e}),M().ui.feed.sendFeedBatchEvent({statEvent:"feed_show_more_less_clicked",batch:e,statParams:{type:e.collapsed?"more":"less"}})},t.prototype.renderExpander=function(e){return!e.collapsed&&e.data.length>1&&1!=this.props.totalBoards?b.React.createElement("div",{className:"feed-batch__expand",onClick:this.toggleCollapsed.bind(this,e)},this.renderExpanderText(e)):""},t.prototype.renderBatchStatistics=function(e){if(this.props.mode==l.a.UNREAD){var t=this.getNotificationCounters(e);return b.React.createElement("div",{className:"feed-card-header__notifications",onClick:this.recordNotificationTypesClick.bind(this,e)},t.map(function(e,t){return b.React.createElement("div",{className:"feed-card-header__notification",key:t},b.React.createElement("svg",{className:"feed-card-header__notification-icon"},b.React.createElement("use",{xlinkHref:e.iconSrc})),b.React.createElement("div",{className:"feed-card-header__notification-counter"},e.counter))}))}},t.prototype.renderNotifications=function(e,t){var n=this;if(e.collapsed){var a=e.data[0],i=[b.React.createElement(oe,{notification:a,showThreadHint:!1,isBatchMode:!0,batchSize:this.props.mode==l.a.ALL?e.statistics.notificationsCount:0,batch:e}),b.React.createElement("div",{className:"feed-card--fake"})];return e.data.length>2&&i.push(b.React.createElement("div",{className:"feed-card--fake"})),b.React.createElement("div",{className:"feed-batch-container",onClick:this.toggleCollapsed.bind(this,e)},i)}return b.React.createElement("div",{className:"feed-batch-container"},e.data.map(function(a,i){var o=t&&0===i;return b.React.createElement(oe,{key:a.id,notification:a,showThreadHint:o,onMoreActionsClick:n.clickCardActions.bind(n,a),isBatchMode:!1,batch:e})}))},t.prototype.renderExpanderText=function(e){return e.collapsed?void 0:b.React.createElement("span",null,"Show less ",b.React.createElement("span",{className:"typo-formular"},"\u2191"))},t.prototype.renderSpinner=function(){return this.props.showListLoader?b.React.createElement(ie.a,null):void 0},t.prototype.reloadFeed=function(){M().ui.feed.reloadFeed(),M().ui.feed.sendFeedEvent({statEvent:"feed_item_clicked",statParams:{action:"refresh_feed"}})},t.prototype.onScroll=function(e){this.tryLoadMoreNotifications(e)},t.prototype.getNotificationCounters=function(e){var t=[],n=e.statistics.typesCounts;return n.ACCESS_REQUESTED>0&&t.push({counter:n.ACCESS_REQUESTED,iconSrc:ye}),n.COMMENT_ADDED>0&&t.push({counter:n.COMMENT_ADDED,iconSrc:xe}),n.USER_MENTIONED>0&&t.push({counter:n.USER_MENTIONED,iconSrc:ve}),t},t.prototype.openBoard=function(e){Object(Q.b)().open({url:K.b.boardLink(e)}),M().ui.feed.sendFeedEvent({statEvent:"feed_item_clicked",statParams:{action:"open_board_title"}})},t.prototype.recordNotificationTypesClick=function(e){M().ui.feed.sendFeedBatchEvent({statEvent:"feed_notification_type_clicked",batch:e})},t.prototype.componentWillUnmount=function(){this.windowClickController.destroy()},t.prototype.renderMessage=function(){return this.state.message?b.React.createElement("div",{className:"feed-message__wrapper"},b.React.createElement("div",{className:"feed-message "+("button"===this.state.message.type?"feed-message--button":""),dangerouslySetInnerHTML:{__html:this.state.message.html},onClick:this.state.message.clickCallback})):void 0},t.prototype.clearMessageTimeout=function(){this.messageTimeoutHandle&&clearTimeout(this.messageTimeoutHandle)},t.prototype.setMessageTimeout=function(){var e=this;this.messageTimeoutHandle=setTimeout(function(){e.hideMessage()},5e3)},t.prototype.hideMessage=function(){this.setState({message:void 0})},t.prototype.showMessage=function(e){this.clearMessageTimeout(),this.setState({message:e})},t.prototype.showTemporaryMessage=function(e){this.showMessage(e),this.setMessageTimeout()},t.prototype.componentDidUpdate=function(e){var t=this;this.props.newNotificationsCount>0&&!this.state.message?(this.newNotificationsMessage={html:"<span>\n\t\t\t\t\t"+this.props.newNotificationsCount+" new notification"+(this.props.newNotificationsCount>1?"s":"")+'\n\t\t\t\t\t<span class="typo-formular"> \u2191</span>\n\t\t\t\t</span>',type:"button",clickCallback:function(){t.reloadFeed()}},this.showMessage(this.newNotificationsMessage)):0===this.props.newNotificationsCount&&this.newNotificationsMessage&&(this.hideMessage(),this.newNotificationsMessage=void 0),this.props.currentAccountId!==e.currentAccountId&&this.setThreadSubscriptionsAvailability()},t.prototype.setThreadSubscriptionsAvailability=function(){var e=this;Object(R.a)().getAccountAsync(this.props.currentAccountId).then(function(t){e.setState({isThreadSubscriptionsAvailable:Object(ue.Q)(t,fe.a.THREAD_SUBSCRIPTIONS)})})},Object(o.c)([b.decorators.autobind],t.prototype,"onRatingClosed",null),Object(o.c)([b.decorators.autobind],t.prototype,"onRatingSubmitted",null),Object(o.c)([b.decorators.autobind],t.prototype,"reloadFeed",null),Object(o.c)([b.decorators.autobind],t.prototype,"onScroll",null),t}(b.React.PureComponent);var Ee=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(o.d)(t,e),t.prototype.render=function(){return this.props.mode!==l.a.ALL&&this.props.hasAnyNotifications?this.renderHasAny():this.renderAllEmpty()},t.prototype.renderAllEmpty=function(){return b.React.createElement("div",{className:"feed-empty-page feed-info"},b.React.createElement("div",{className:"feed-info__header"},b.React.createElement("img",{className:"feed-info__image",src:n(2176)}),b.React.createElement("div",{className:"feed-info__heading"},"Don\u2019t miss important updates!")),b.React.createElement("div",{className:"feed-info__text"},"You don't have any notifications yet. @mention someone from your team on a board and check for updates here."))},t.prototype.renderHasAny=function(){return b.React.createElement("div",{className:"feed-empty-page feed-info"},b.React.createElement("div",{className:"feed-info__header"},b.React.createElement("img",{className:"feed-info__image",src:n(2176)}),b.React.createElement("div",{className:"feed-info__heading"},"Don\u2019t miss important updates!")),b.React.createElement("div",{className:"feed-info__text"},"You're up to date. Switch to"," ",b.React.createElement("a",{className:"rtb-link rtb-link--primary",onClick:this.switchToAllUpdates},"All updates")," ","to view your team updates history."))},t.prototype.switchToAllUpdates=function(){M().ui.feed.changeFeedMode({mode:l.a.ALL})},t}(b.React.PureComponent);function we(){return Object(i.a)({restrict:"E",template:n(4709),controller:f,controllerAs:"ctrl"})}var Re=n(167),ke=n.n(Re),Oe=n(554),Ne=n(120),Se=n(49),Te=n(59),Ae=n(39),Ce=n(162),Me=n(160),je=n(71),Ie=n(77),De=n(72);function Le(e,t,n){var a=Object(o.a)(Object(o.a)({},Fe(t)),n);Object(Ie.a)().sendApiEvent(e,a)}function Fe(e){var t=Object(De.a)().isBoardOpened()?Object(Ae.a)().currentBoard:void 0;return{app_type:Object(Me.a)(Object(Me.b)()),device_os:Ce.b,client_id:t?t.clientId.toString():void 0,account_id:ue.tb(e)?je.p:e.id,board_id:t?t.boardInfo.id:void 0,org_id:ue.a(e)?e.organization.id:void 0,clicked_from:t?"board":"dashboard"}}var Be=Object(Se.b)("closeFeed",function(e){var t=e.input,n=e.state;Object(u.a)().rightSidebar.deactivate(Te.a.FEED),Le("feed_closed",n.get("dashboard.currentSpace"),{click_on:t.clickOn})}),Ue=n(301),Pe=n(32),He=Object(Se.c)("getNotifications",function(e){var t=e.state,n=e.output,a=e.services,i=function(e){var t={offset:e.get("ui.feed.notificationsOffset"),limit:e.get("ui.feed.notificationsLimitPerPage"),beforeDate:e.get("ui.feed.actualDate"),filter:e.get("ui.feed.mode")};return t.accountId=Object(v.a)().getCurrentId(),t}(t);a.API.notifications.array(i).get({limit:i.limit,offset:i.offset}).then(function(e){return{notifications:e.data.map(function(e){return e.data=e.data.map(function(e){return e.isRead=E(e),e}),e}),size:e.size}}).then(function(e){return 1===e.size?Pe.a.notifications.getBoardNotifications({boardId:e.notifications[0].context.board.id,accountId:e.notifications[0].context.account.id,beforeDate:t.get("ui.feed.actualDate"),filter:t.get("ui.feed.mode")}).then(function(t){var n=t.data.map(function(e){return e.isRead=E(e),e});return Object.assign(e.notifications[0],{collapsed:!1,loaded:!0,data:n}),e}):e}).then(function(e){return n.done(e)}).catch(function(e){return n.fail({error:e})})},void 0,Se.a);function ze(e){return e.id}var qe=Object(Se.b)("addNotifications",function(e){var t=e.input,n=e.state,a=function(e,t){var n=new Map,a=[].concat(e);return t.forEach(function(e){n.set(ze(e),e)}),e.forEach(function(e){n.has(ze(e))&&n.delete(ze(e))}),t.forEach(function(e){var t=n.get(ze(e));t&&(t.loaded||(t.collapsed=t.data.length>1,t.loaded=!t.collapsed),a.push(t))}),a}(n.get("ui.feed.notifications"),t.notifications);n.set("ui.feed.notifications",a),n.set("ui.feed.totalBoards",t.size),n.set("ui.feed.hasMoreNotifications",t.notifications.length===n.get("ui.feed.notificationsLimitPerPage")),n.set("ui.feed.notificationsOffset",n.get("ui.feed.notificationsOffset")+t.notifications.length)},{notifications:Array}),Ge=Object(Se.b)("checkEmptyNotificationsList",function(e){var t,n=e.state,i=e.output,o=n.get("ui.feed.hasMoreNotifications"),r=n.get("ui.feed.notifications"),s=n.get("ui.feed.firstTimeGreetingVisible"),c=n.get("ui.feed.mode");0!==r.length||o||s?(t=a.NOTIFICATIONS,s&&r.length>0&&Object(R.a)().achievements.open(de.a.FEED_FIRST_NOTIFICATION)):t=a.EMPTY,n.set("ui.feed.page",t),t===a.EMPTY&&c===l.a.UNREAD?i.emptyUnread():i.default()},void 0,["emptyUnread","default"]),Ve=Object(Se.c)("checkHasAnyNotifications",function(e){var t=e.state,n=e.output,a=e.services,i=function(e){var t={offset:0,limit:0,beforeDate:e.get("ui.feed.actualDate"),filter:l.a.ALL};return t.accountId=Object(v.a)().getCurrentId(),t}(t);a.API.notifications.array(i).get({limit:i.limit,offset:i.offset}).then(function(e){var t=e.size;n({hasAnyNotifications:t>0})})}),Ye=n(132),We=[Ge,{emptyUnread:[Ve,Object(Ye.a)("hasAnyNotifications","ui.feed.hasAnyNotifications")],default:[]}],$e=[Object(Ue.a)("ui.feed.hasMoreNotifications"),{isTrue:[Object(Ne.a)("ui.feed.showListLoader",!0),He,{done:Object(o.i)([qe],We),fail:[]},Object(Ne.a)("ui.feed.showListLoader",!1)],isFalse:[]}],Qe=Object(Se.b)("toggleBulkNotification",function(e){var t,n=e.input,a=e.output,i=e.state.get("ui.feed.notifications"),o=i.find(function(e,a){return e.id===n.bulkNotification.id&&(t=a,!0)});if(o){var r={};Object.assign(r,o,{collapsed:!n.bulkNotification.collapsed}),a({notifications:i=y(i,r,t)})}}),Ke=Object(Se.c)("loadBulkNotification",function(e){var t=e.input,n=e.output,a=e.state,i=t.bulkNotification;t.bulkNotification.loaded?n.skip():Pe.a.notifications.getBoardNotifications({boardId:i.context.board.id,accountId:i.context.account.id,beforeDate:a.get("ui.feed.actualDate"),filter:a.get("ui.feed.mode")}).then(function(e){var i,o=a.get("ui.feed.notifications"),r=(o.find(function(e,n){return e.id===t.bulkNotification.id&&(i=n,!0)}),e.data.map(function(e){return e.isRead=E(e),e})),s=t.bulkNotification.data.filter(function(e){return!r.find(function(t){return t.id===e.id})});r.unshift.apply(r,s),Object.assign(e,{collapsed:!t.bulkNotification.collapsed,loaded:!0,data:r}),o=y(o,e,i),n.loaded({notifications:o})})},void 0,["loaded","skip"]),Je=[Qe,Object(Ye.a)("notifications","ui.feed.notifications"),Ke,{loaded:[Object(Ye.a)("notifications","ui.feed.notifications")],skip:[]}],Xe=Object(Se.b)("setActualParams",function(e){var t=e.state;t.set("ui.feed.actualDate",Date.now()),t.set("ui.feed.currentAccountId",t.get("app.currentAccountId"))}),Ze=n(81),et=n(136),tt=[Xe,Object(Se.b)("checkFirstTime",function(e){var t=e.input,n=e.state,a=!Object(R.a)().achievements.isOpened(de.a.FEED_FIRST_NOTIFICATION);n.set("ui.feed.firstTimeGreetingVisible",a);var i=Ze.a(et.a.feedLastOpenDate),o=new Date;o.setHours(5,0,0,0),n.set("ui.feed.todayGreetingVisible",t.automatically&&(!i||i<o.getTime()))}),$e],nt=[Object(Ne.a)("ui.feed.page",a.LOADER),Object(Ne.a)("ui.feed.notifications",[]),Object(Ne.a)("ui.feed.newNotificationsCount",0),Object(Ne.a)("ui.feed.notificationsOffset",0),Object(Ne.a)("ui.feed.hasMoreNotifications",!0),Object(Ne.a)("ui.feed.totalBoards",0)],at=n(101),it=n(103),ot=it.a.toMillis(3),rt=it.a.toMillis(30),st=Object(Se.b)("checkRateNecessity",function(e){var t=e.state,n=Object(R.a)().achievements.isOpened(de.a.FEED_RATED_FIRST_TIME),a=n?rt:ot,i=Ze.a(et.a.feedLastRatedDate);n&&null==i||(n||null!=i||Object(at.E)(et.a.feedLastRatedDate),Object(at.a)(et.a.feedLastRatedDate,a)&&t.set("ui.feed.showRateRequest",!0))}),ct=Object(o.i)(nt,[st],tt),dt=n(967),lt=Object(o.i)(ct,dt.a),pt=Object(Se.c)("processFeedUpdates",function(e){var t=e.state,n=e.input,a=e.output,i=e.services;if(n.lastNotificationDate){var o=Object(v.a)().getCurrentId(),r=new Date(t.get("ui.feed.actualDate")).getTime();r>new Date(n.lastNotificationDate).getTime()?a.notUpdated():i.API.notifications.getUpdates({accountId:o,afterDate:r}).then(function(e){var n=function(e,t){var n=0,a=[],i=[];return t.data.forEach(function(t){var n=e.find(function(e){return e.id===t.id});if(n)t.data.forEach(function(e){var t=n.data.find(function(t){return t.id===e.id});if(t){var o=!1;Array.isArray(e.data)?e.data.forEach(function(e){var t=!!e.read;o=o||!t}):o=!e.read,!!t.isRead!==!o&&(o?Array.isArray(e.data)?i=i.concat(e.data):i.push(e):a.push({notification:e,newState:{isRead:!0}}))}else i=i.concat(e.data)});else{var o=t.data.reduce(function(e,t){return Array.isArray(t.data)?e=e.concat(t.data):e.push(t),e},[]);i=i.concat(o)}}),i.forEach(function(e){e.read||n++}),{notificationUpdateState:a,newNotificationsCountDiff:n}}(t.get("ui.feed.notifications"),e);a.updated(n)})}else a.notUpdated()},void 0,["updated","notUpdated"]);var ut=Object(Se.b)("storeNotificationState",function(e){var t=e.state;e.input.notificationUpdateState.forEach(function(e){var n,a=t.get("ui.feed.notifications"),i=a.find(function(t,a){return t.context.board.id===e.notification.context.board.id&&(n=a,!0)});if(i){var r,s=i.data.find(function(t,n){return t.id===e.notification.id&&(r=n,!0)});if(s){var c={};ke()(c,s,Object(o.a)(Object(o.a)({},e.newState),{changeDate:Date.now()}));var d=y(i.data,c,r),l={};Object.assign(l,i,{data:d});var p=y(a,l,n);t.set("ui.feed.notifications",p)}}})}),ft=Object(Se.b)("updateNewNotificationsCount",function(e){var t=e.state,n=e.input;if(n.newNotificationsCountDiff){var a=t.get("ui.feed.newNotificationsCount");a+=n.newNotificationsCountDiff,t.set("ui.feed.newNotificationsCount",a)}}),ht=Object(o.i)([ut],dt.a,[ft]),mt=[Object(Se.b)("CheckNewNotificationsForEmptyState",function(e){var t=e.state,n=e.output,i=t.get("ui.feed.newNotificationsCount");t.get("ui.feed.page")===a.EMPTY&&i>0?n.reload():n.cancel()},void 0,["reload","cancel"]),{reload:lt,cancel:[]}],bt=[pt,{updated:Object(o.i)(ht,mt),notUpdated:[]}],gt=[Object(Se.c)("postNotificationReadState",function(e){var t=e.input,n=e.services,a=e.output;if(t.notificationUpdateState){var i=t.notificationUpdateState.reduce(function(e,t){return e=Array.isArray(t.notification.data)?e.concat(t.notification.data.map(function(e){return e.id})):e.concat(t.notification.id)},[]);if(i.length>0){var o=t.notificationUpdateState[0].notification.context.account.id;t.notificationUpdateState[0].newState.isRead?n.API.notifications.markAsRead({accountId:o,notificationsIds:i}).then(function(){a.done()}).catch(function(){return a.fail()}):n.API.notifications.markAsUnRead({accountId:o,notificationsIds:i}).then(function(){a.done()}).catch(function(){return a.fail()})}}},void 0,Se.a),{done:ht,fail:[]}],vt=Object(Se.c)("replyInThread",function(e){var t=e.input,n=e.state,a=e.output,i=e.services,r=n.get("ui.feed.activeThread"),s=n.get("ui.feed.notifications").find(function(e){return e.context.board.id===r.context.board.id});if(s){var c=s.data.find(function(e){return e.id===r.id});if(c&&c.data.length>0){var d=c.data[0].id;i.API.notifications.reactToNotification({accountId:Object(v.a)().getCurrentId()||"",notificationId:d,payload:t.message,reaction:"COMMENT"}).then(function(){var e=r.context;!function(e,t){var n=Object(o.a)(Object(o.a)({},Fe(e)),t);Object(Ie.a)().sendApiEvent("comment_message_changed",n)}(n.get("dashboard.currentSpace"),{boardId:e.board.id,change_type:"added",widget_id:e.thread.threadId,text_length:t.message.length,medium:"feed",source:e.document?"notes":"board"}),a.done({context:e,notificationId:r.id})})}else a.fail()}else a.fail()},void 0,Se.a),xt=Object(Se.c)("loadThread",function(e){var t=e.input,n=e.output,a=e.services,i=e.state,o={accountId:t.context.account.id,boardId:t.context.board.id,threadId:t.context.thread.threadId,documentId:t.context.document?t.context.document.id:void 0,beforeDate:i.get("ui.feed.actualDate"),filter:l.a.ALL};a.API.notifications.getThreadDetails(o).then(function(e){return n.done({thread:e})}).catch(function(e){return n.fail({error:e})})},void 0,Se.a),yt=Object(Se.b)("readThreadNotifications",function(e){e.state;var t=e.input;(0,e.output)({notificationUpdateState:[{notification:{context:t.thread.context,id:t.notificationId},newState:{isRead:!0}}]})}),_t=Object(Se.b)("showAutoFollowTipIfNeed",function(e){var t=e.input,n=e.state,a=Object(R.a)().achievements,i=t.thread.parameters.subscriptionMode;!a.isOpened(de.a.FEED_FIRST_SUBSCRIBED_THREAD)&&i&&i===pe.a.AUTO_SUBSCRIBED&&(n.set("ui.feed.showAutoFollowTip",!0),a.open(de.a.FEED_FIRST_SUBSCRIBED_THREAD))}),Et=[xt,{done:Object(o.i)([_t,yt],ht,[Object(Ye.a)("thread","ui.feed.activeThread"),Object(Ne.a)("ui.feed.page",a.THREAD)]),fail:[]}],wt=n(238),Rt=Object(Se.b)("markRateNecessity",function(e){var t=e.state;Object(R.a)().achievements.isOpened(de.a.FEED_RATED_FIRST_TIME)||t.set("ui.feed.showRateRequest",!0)}),kt=[vt,{done:Object(o.i)([Rt,Object(wt.a)("ui.feed.activeThread","thread"),yt],ht,dt.a,[Et]),fail:[]}],Ot=Object(Se.b)("openMentionsList",function(e){var t=e.input,n=e.state,a=t.mentions,i={data:a,visible:a.suggestions.length||a.custom.length};n.set("ui.feed.mentionsList",i)}),Nt=Object(o.i)([Object(wt.a)("ui.feed.actualDate","beforeDate"),Object(Ne.a)("ui.feed.firstTimeGreetingVisible",!1),Object(Ne.a)("ui.feed.showAutoFollowTip",!1)],Et),St=Object(Se.b)("sendOpenFeedEvent",function(e){var t=e.input,n=e.state,a=n.get("ui.feed.notifications"),i=n.get("app.currentAccountId");Le("feed_opened",n.get("dashboard.currentSpace"),{opening_type:n.get("ui.feed.todayGreetingVisible")?"Automatically":"Manual",feed_filter:n.get("ui.feed.mode"),unread_notifications_count:i?t.unreadNotificationsCount[i]:0,boards_count:n.get("ui.feed.totalBoards"),first_page_notifications_count:a.reduce(function(e,t){return e+t.statistics.notificationsCount},0),first_page_comment_notifications_count:a.reduce(function(e,t){return e+t.statistics.typesCounts.COMMENT_ADDED},0),first_page_mention_notifications_count:a.reduce(function(e,t){return e+t.statistics.typesCounts.USER_MENTIONED},0)})}),Tt=Object(Se.b)("storeFeedOpenDate",function(){Object(at.E)(et.a.feedLastOpenDate)}),At=Object(Se.b)("forceFeedMode",function(e){var t=e.state,n=e.input;n.mode&&t.set("ui.feed.mode",n.mode)}),Ct=Object(o.i)([At],lt,[Tt,St,Object(Ne.a)("ui.feed.loaded",!0)]),Mt=Object(Se.b)("sendFeedEvent",function(e){var t=e.input,n=e.state;Le(t.statEvent,n.get("dashboard.currentSpace"),t.statParams)}),jt=Object(Se.b)("sendFeedBatchEvent",function(e){var t=e.input,n=e.state;!function(e,t,n,a){var i=Object(o.a)(Object(o.a)(Object(o.a)({},Fe(t)),a),{notification_account_id:n.context.account.id,notification_board_id:n.context.board.id});Object(Ie.a)().sendApiEvent(e,i)}(t.statEvent,n.get("dashboard.currentSpace"),t.batch,t.statParams)}),It=Object(Se.b)("sendFeedNotificationEvent",function(e){var t=e.input,n=e.state;!function(e,t,n,a){var i=Object(o.a)(Object(o.a)(Object(o.a)({},Fe(t)),a),{notification_id:n.id,notification_type:n.type.name,notification_account_id:n.context.account.id,notification_board_id:n.context.board.id,notification_thread_id:n.context.thread&&n.context.thread.threadId});Object(Ie.a)().sendApiEvent(e,i)}(t.statEvent,n.get("dashboard.currentSpace"),t.notification,t.statParams)}),Dt=Object(Se.b)("markAllNotificationsAsRead",function(e){var t=e.state,n=(e.services,e.output,t.get("ui.feed.notifications"));n=n.map(Lt),t.set("ui.feed.notifications",n)});function Lt(e){if(e.data){var t=e.data.map(Lt);return Object.assign({},e,{isRead:!0,data:t})}return Object.assign({},e,{isRead:!0,read:!0})}var Ft=[Object(Se.c)("postReadAll",function(e){e.state;var t=e.services,n=e.output,a=Object(v.a)().getCurrentId();a&&t.API.notifications.markAsRead({accountId:a}).then(function(){n.done()}).catch(function(){return n.fail()})}),{done:[Dt,Object(Ne.a)("ui.feed.newNotificationsCount",0),Object(Ne.a)("user.unreadNotificationsCount",0)],fail:[]}],Bt=Object(Se.b)("closeRating",function(e){e.state.set("ui.feed.showRateRequest",!1),Object(at.E)(et.a.feedLastRatedDate),Object(R.a)().achievements.isOpened(de.a.FEED_RATED_FIRST_TIME)?Object(at.y)(et.a.feedLastRatedDate):Object(R.a)().achievements.open(de.a.FEED_RATED_FIRST_TIME)}),Ut=n(26),Pt=Object(Se.b)("submitRating",function(e){var t=e.input,n=e.state,a=Object(R.a)().myUserId,i=Object(Me.b)(),r=n.get("dashboard.currentSpace"),s=ue.tb(r)?je.p:r.id;Object(Ut.zh)(Object(o.a)({account_id:s,user_id:a&&a.toString()||null,app_type:i,device_os:Ce.b},t.params))}),Ht=n(88).monkey({cursors:{loaded:"ui.feed.loaded".split("."),unreadNotificationsCount:"user.currentUnreadNotificationsCount".split("."),newNotificationsCount:"ui.feed.newNotificationsCount".split(".")},get:function(e){var t=e.loaded,n=e.unreadNotificationsCount,a=e.newNotificationsCount;return t&&n-a>0}}),zt=n(124),qt=n(79);function Gt(e,t){Object(zt.b)().then(function(n){return n.showShareBoardModalById(e.context.account.id,e.context.board.id,"",[e.parameters.requester]).then(function(n){return t.done(Vt(e,n))})})}function Vt(e,t){return{notificationUpdateState:[{notification:e,newState:{reaction:t?{actor:{id:Object(R.a)().userInfo.id}}:void 0,isRead:!0}}]}}var Yt=[Object(Se.c)("acceptBoardAccess",function(e){var t=e.input,n=(e.state,e.output),a=e.services;t.notification.parameters.hasAccessToAccount?a.API.notifications.reactToNotification({accountId:Object(v.a)().getCurrentId()||"",notificationId:t.notification.id,reaction:"ACCEPT"}).then(function(){n.done(Vt(t.notification,!0))}).catch(function(e){"accountUsersLimitReached"===qt.b.getJsonError(e).reason&&Gt(t.notification,n)}):Gt(t.notification,n)},void 0,Se.a),{done:gt,fail:[]}],Wt=n(464),$t=[Object(Se.c)("requestBoardAccess",function(e){var t=e.state,n=e.input,a=e.output;Object(Wt.b)(n.boardId).then(function(){var e=t.get("ui.feed.activeThread");a.done({context:e.context,notificationId:e.id})}).catch(function(){a.fail()})},void 0,Se.a),{done:[Object(wt.a)("ui.feed.activeThread","thread"),Et],fail:[]}],Qt=n(743),Kt=[Object(Se.c)("changeThreadFollowState",function(e){var t,n,a=e.input,i=e.services,o=e.output,r=i.API.profile;t=a.subscriptionMode===pe.a.MANUALLY_SUBSCRIBED?r.subscribeNotification.bind(r):r.unsubscribeNotification.bind(r),n=a.notification.context.document?a.notification.context.board.id+"/"+a.notification.context.document.id+"/"+a.notification.context.thread.threadId:a.notification.context.board.id+"/"+a.notification.context.thread.threadId,t(Qt.a.SOURCES,n).then(function(){o.done({notificationUpdateState:[{notification:a.notification,newState:{parameters:{subscriptionMode:a.subscriptionMode}}}]})}).catch(function(){return o.fail()})},void 0,Se.a),{done:[ut],fail:[]}],Jt=[Object(Se.c)("changeBoardFollowState",function(e){var t=e.input,n=e.services,a=e.output,i=n.API.profile;(t.subscriptionMode===pe.a.MANUALLY_SUBSCRIBED?i.subscribeNotification.bind(i):i.unsubscribeNotification.bind(i))(Qt.a.SOURCES,t.board.context.board.id).then(function(){var e=t.board.data.map(function(e){return{notification:e,newState:{parameters:{subscriptionMode:t.subscriptionMode}}}}),n=[{bulk:t.board,newState:{parameters:{subscriptionMode:t.subscriptionMode}}}];a.done({notificationUpdateState:e,bulkUpdateState:n})}).catch(function(){return a.fail()})},void 0,Se.a),{done:[ut,Object(Se.b)("storeBulkState",function(e){var t=e.state;e.input.bulkUpdateState.forEach(function(e){var n,a=t.get("ui.feed.notifications"),i=a.find(function(t,a){return t.context.board.id===e.bulk.context.board.id&&(n=a,!0)});if(i){var r={};Object.assign(r,i,Object(o.a)({},e.newState));var s=y(a,r,n);t.set("ui.feed.notifications",s)}})})],fail:[]}];function Xt(e){return e.addPaths(["mode","showRateRequest"]),function(t){var n=e.getModuleState(),i={loaded:!1,showWaiter:!1,actualDate:void 0,page:a.LOADER,mode:l.a.UNREAD,currentAccountId:void 0,notifications:[],notificationsOffset:0,notificationsLimitPerPage:20,showListLoader:!0,showRateRequest:!1,showAutoFollowTip:!1,hasMoreNotifications:!0,hasAnyNotifications:!1,activeThread:void 0,newNotificationsCount:0,mentionsList:{visible:!1,data:{}},totalBoards:0,firstTimeGreetingVisible:!1,hasUnreadNotifications:Ht,todayGreetingVisible:!1};i=ke()({},i,n),t.addState(i),t.addSignals({openFeed:Ct,reloadFeed:lt,reloadFeedList:ct,closeFeed:[Be],loadMoreNotifications:$e,toggleBulkNotification:Je,openThread:Nt,openFeedList:[Object(Ne.a)("ui.feed.page",a.NOTIFICATIONS),st],replyInThread:kt,acceptBoardAccess:Yt,processFeedUpdates:bt,changeNotificationReadState:gt,openMentionsList:[Ot],closeMentionsList:[Object(Ne.a)("ui.feed.mentionsList",{visible:!1})],changeFeedMode:Object(o.i)([Object(Ye.a)("mode","ui.feed.mode")],lt),sendFeedEvent:[Mt],sendFeedBatchEvent:[jt],sendFeedNotificationEvent:[It],markAllAsReadChain:Ft,closeRating:[Bt],submitRating:[Pt,Bt],requestBoardAccess:$t,changeThreadFollowState:Kt,changeBoardFollowState:Jt,hideAutoFollowTip:[Object(Ne.a)("ui.feed.showAutoFollowTip",!1)]})}}!function(){var e=Oe.b(),t=e.observer;e.module.addModules({feed:Xt(t.getObserverForModule("feed"))})}(),n(4707),ae(),Object(h.b)().component("feedEmptyPage",Object(m.a)(Object(b.cerebralConnect)({mode:"ui.feed.mode",hasAnyNotifications:"ui.feed.hasAnyNotifications"},Ee))),Object(h.b)().component("feedNotificationsList",Object(m.a)(Object(b.cerebralConnect)({notifications:"ui.feed.notifications",hasMoreNotifications:"ui.feed.hasMoreNotifications",showListLoader:"ui.feed.showListLoader",newNotificationsCount:"ui.feed.newNotificationsCount",totalBoards:"ui.feed.totalBoards",firstTimeGreetingVisible:"ui.feed.firstTimeGreetingVisible",showRateRequest:"ui.feed.showRateRequest",todayGreetingVisible:"ui.feed.todayGreetingVisible",mode:"ui.feed.mode",currentAccountId:"ui.feed.currentAccountId"},_e))),Object(h.b)().directive("feed",we);var Zt={closeFeed:function(e){M().ui.feed.closeFeed({clickOn:e})}};t.default=Zt}}]);
//# sourceMappingURL=Feed.09ef6202dc3a7fd44ecc.js.map