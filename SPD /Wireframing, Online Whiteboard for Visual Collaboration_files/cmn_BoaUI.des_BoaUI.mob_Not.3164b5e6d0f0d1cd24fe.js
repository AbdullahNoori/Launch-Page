(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{2214:function(e,t,n){"use strict";(function(e){var o=n(57),i=n(135),s=n(71),r=n(74),a=n(249),c=n(122),l=n(50),m=n(744),u=n(26),p=n(34),d=n(92),h=n(75),g=c.b(),f=function(e){return"stop-textarea-click-"+e};t.a=function(t,n,c,b){var y=t.comment,T=t.message&&t.message.text||"",v=0,w=function(e){void 0===e&&(e=!0),t.editMode=!e,e&&(n.find(":focus").blur(),document.activeElement&&document.activeElement.blur()),C()},M=function(e){o.e(e.target,function(e){return Object(l.k)(e,f(t.id))||Object(l.k)(e,"emoji-picker")||"mentions"==e.id})||(t.editor.controller.save(),t.safeApply())},O=o.i(t.message.timestampData);function S(){var e=n.parents(".comment-body__messages"),o=e.scrollTop(),i=e.outerHeight(),s=n.outerHeight(),r=n.position().top,a=t.editor.controller.getScrollTop(),c=t.editor.controller.getLineHeight(),l=o+r;if(l<=o+2*c||l+s>=o+i-2*c){var m=s<i?l:l+a-i/2.5;e.scrollTop(m)}}function C(){document.removeEventListener("click",M,!0)}t.editMode=!1,t.id=i.b(),t.timestamp=O.getTime(),t.editor={},t.isAllowEdit=g().allowEdit,t.isTouchSupported=e.isTouchSupported,t.isGuest=function(){return Object(p.a)().userType==d.a.GUEST},t.showEmojiPicker=function(e){Object(m.a)().show(e.currentTarget.getBoundingClientRect()).then(function(e){e&&(t.editMode?t.addEmojiToMessage(e):t.addReactionToMessage(e))})},t.addEmojiToMessage=function(e){var n=t.editor.controller.getEditor(),o=n.selectionStart,i=t.$parent.addEmojiToMessage(e,o,n.value);t.$parent.isAppleDevice?t.message.text=i:t.editor.controller.change(i),setTimeout(function(){n.focus(),t.editor.controller.scrollIntoView()},300)},t.addReactionToMessage=function(e){e&&t.message.emojis&&t.message.emojis.some(function(t){return t.name===e.name})||(y.replyToggleEmoji(t.message,e.name),h.a.comments.commentMessageReactionAdded(y,t.message.id,e.name,y.messages.length),t.scrollToLastMessage()),t.safeApply()},t.scrollToLastMessage=function(){var e=y.messages;e.findIndex(function(e){return e.id===t.message.id})!=e.length-1||t.message.emojis&&0!==t.message.emojis.length||setTimeout(t.$parent.scrollToMessage,300)},t.toggleEmoji=function(e){y.replyToggleEmoji(t.message,e.name),h.a.comments.commentMessageReactionRemoved(y,t.message.id,e.name,y.messages.length)},t.saveMessage=function(){var e=t.message,n=e.text;T!==n&&(n?y.replyUpdate(e,T):t.$parent.messages.messages.length>1?t.canDelete?y.replyDelete(e):e.text=T:(e.text=T,y.commentDelete())),w()},t.applyMessage=function(){e.isTouchSupported&&t.editor.controller.save()},t.cancelMessage=function(e){e.preventDefault(),t.editor.controller.cancel(),w()},t.messageFocused=function(){return t.editor.controller.getEditor().selectionStart=999999,void(v=setTimeout(S,200))},t.messageChanged=function(){return S()},t.deleteMessage=function(){w(),u.Pe(),1==t.$parent.messages.messages.length?y.commentDelete():y.replyDelete(t.message)},t.edit=function(){T=t.message.text,w(!1),e.mobile||t.editor.controller.edit(),t.safeApply(),e.mobile||document.addEventListener("click",M,!0),u.of(),Object(m.a)().hide(),t.scrollToLastMessage()},a.a(t.message.senderId?t.message.senderId.toString():"0").then(function(e){t.userName=r.h(e.name),t.userPicture=e.picture.medium||s.j,t.safeApply()}).catch(function(){}),t.$on("$destroy",function(){C(),clearTimeout(v)})}}).call(this,n(0))},2215:function(e,t,n){"use strict";(function(e){var o=n(21),i=n(0),s=n(57),r=n(34),a=n(92),c=n(231),l=n(212),m=n(45),u=n(599),p=n(122),d=n(50),h=n(26),g=n(180),f=n(4970),b=n(60),y=n(908),T=n(136),v=n(101),w=n(32),M=n(661),O=n(73),S=n(127),C=n(241),j=n(418),E=n(39),R=n(104),k=n(124),I=n(163),_=n(398),$=n(75),A=n(94),D=n(2216),N=c.b(),x=r.b(),P=m.b(),L=p.b(),U=function(){function t(e,t,n){var o=this;function r(){e.denyScrollToMessage||n(function(){var t,n=e.messages.$element,o=e.comment.lastReadableMessage;-1!=o?(e.comment.clearLastReadableMessage(),t=n.find(".comment-message").eq(o)):t=i.mobile?n.find(".reply-button"):n.find(".comment-message:last"),t.length&&t[0].scrollIntoView(70)})}this.$scope=e,this.$element=t,this.$timeout=n,this.ignoreReconnection=!1,this.isTipVisible=!1,this.addReplyInProgress=!1,this.replyTextareaClick=function(e){!s.e(e.target,function(e){return Object(d.k)(e,"stop-reply-click")})&&o.$scope.messages.any()&&(o.$scope.comment.lastReplyingMessage||o.$scope.cancelReplyMessage(),document.removeEventListener("click",o.replyTextareaClick,!0))},e.menu={visibility:!1},N().setFocus(l.a.COMMENT),this.initUserData(),this.initMessagesData(),this.initReplyData(),e.getPlaceholder=function(){return e.comment.resolved?i.mobile?"Reply will re-open the discussion":"Adding a reply will re-open the discussion":i.mobile?e.messages.any()?"Leave a reply. Use @ to mention.":"Leave a comment":e.messages.any()?"Leave a reply. Use @ to mention.":"Type a message. Use @ to mention."},e.getReplyBtnText=function(){return e.messages.any()?"Reply":"Leave a comment"},e.resolved=function(){return e.comment.resolved},e.canResolve=function(){return e.comment.canResolve()},e.toggleResolve=function(){e.comment.toggleResolved(),$.a.comments.commentStateChanged(e.comment)},e.toggleMenu=function(t){e.menu.visibility=!e.menu.visibility,e.menu.visibility&&h.ce(),t.preventDefault(),t.stopPropagation()},e.setCommentColor=function(t){$.a.comments.commentColorChanged(e.comment,t),e.colors.click(t),L().setColor(t)},e.messages.messagesChanged=function(t){var n=!this.messages||this.messages.length!==t.length;this.format(t),e.safeApply(),e.fixScreenPosition&&e.fixScreenPosition(),n&&r()},e.comment.cmtMessagesChanged.add(e.messages.messagesChanged,e.messages),e.comment.cmtLastReadableMessageChanged.add(r),e.tip={visible:!1},this.tryToShowFirstUnreadThreadTip(e.comment),e.setReplyMode=function(){e.reply.replying=!0,document.addEventListener("click",o.replyTextareaClick,!0)},e.applyReplyMessage=function(){e.reply.controller.save()},e.onReplyMessageChanged=function(t){e.comment.lastReplyingMessage=t,e.reply.opened||(e.reply.opened=!!t.length,n(function(){e.fixScreenPosition&&e.fixScreenPosition(),u.b().reopen()},115))},e.tryRemove=function(){e.messages.any()||e.comment.commentDelete(!1)},e.blurActiveElement=function(){document.activeElement&&document.activeElement.blur()},e.addReplyMessage=function(){if(!o.addReplyInProgress){o.addReplyInProgress=!0;var t=e.reply.message;o.checkMessage(t).then(function(){return o.checkAuth(t)}).catch(function(){return e.tryRemove(),Promise.reject()}).then(function(){return o.checkCustomMentionsSize()}).then(function(){return o.addReplyMessageStep2(t)}).then(function(){return e.comment.setCmtMode(!0)}).catch(function(){return o.$scope.focusComment()}).then(function(){o.addReplyInProgress=!1})}},e.focusComment=function(){setTimeout(function(){try{e.reply.controller.view(),e.reply.$element.find("textarea").click()}catch(e){}},200)},e.cancelReplyMessage=function(){e.reply.controller&&e.reply.controller.cancel(),e.endReplyMessage(),e.tryRemove()},e.endReplyMessage=function(){e.reply.message="",e.reply.opened=!1,e.reply.replying=!0,e.comment.lastReplyingMessage="",e.safeApply()},e.followState=Object(D.a)(e.comment),e.$on("$destroy",function(){e.messages.any()||!e.reply.controller||o.ignoreReconnection||e.reply.controller.save(),e.comment.cmtLastReadableMessageChanged.remove(e.scrollToMessage),e.comment.cmtMessagesChanged.remove(e.messages.messagesChanged,e.messages),e.comment.resolved&&!Object(C.a)().showResolved&&(Object(C.a)().tryShowCollaborationTools(),L().widgetVisibilityChanged(e.comment,!1)),N().setFocus(l.a.CANVAS)}),e.scrollToMessage=r,e.isAppleDevice=i.ios||i.mac,e.addEmojiToMessage=function(e,t,n){var o=g.j(n,0,t),i=g.j(n,t);return g.i(o+":"+e.name+":"+i)}}return t.prototype.isNoNameUser=function(){var e=x().userInfo;return x().userType==a.a.GUEST||e.temporary&&!e.storedName},t.prototype.checkMessage=function(e){return e?Promise.resolve():Promise.reject(void 0)},t.prototype.checkAuth=function(e){var t=this;return this.isNoNameUser()?(this.ignoreReconnection=!0,this.authUser(e).then(function(){t.ignoreReconnection=!1})):Promise.resolve()},t.prototype.checkCustomMentionsSize=function(){var e=this.$scope.reply.controller.getParseResult();if(e&&e.customMentionsSizes){var t=0,n=[];for(var o in e.customMentionsSizes){var i=e.customMentionsSizes[o]||0;i>0&&(t+=i,n.push(_.b[o]))}return t>5?new Promise(function(e,o){var i={title:t+" people will be notified",text:"By using <b>"+n.join(", ")+"</b> mention"+(n.length>0?"s":"")+" you are about to notify "+t+" people who have access to this board. Are you sure?",info:!0,submitButton:{caption:"Send it now"},cancelButton:{caption:"Edit message"},enableSubmitByEnter:!0},s=P().show(Object(I.a)(i));s.submitted.addOnce(function(){h.Ig(!0),e()}),s.canceled.addOnce(function(){h.Ig(!1),o()})}):Promise.resolve()}return Promise.resolve()},t.prototype.addReplyMessageStep2=function(e){e?(this.$scope.messages.any()?this.$scope.comment.replyCreate(e):this.$scope.comment.commentCreateOnServer(e),this.$scope.focusComment(),this.tryShowReplyTips()):this.$scope.tryRemove(),this.$scope.endReplyMessage()},t.prototype.authUser=function(t){var n=e.Deferred();if(this.isNoNameUser()){var o=P().show(Object(f.a)());o.canceled.addOnce(n.reject),o.submitted.addOnce(n.resolve)}else n.resolve(t);return n.promise()},t.prototype.initUserData=function(){var e=x().myUserId;this.$scope.myUserIdStr=e&&e.toString()||""},t.prototype.initMessagesData=function(){this.$scope.messages={$element:null,messages:[],format:function(t){this.messages=t.map(function(t){return e.extend(t,{senderIdStr:t.senderId?t.senderId.toString():"0",fromNow:A(s.i(t.timestampData)).format("DD MMM HH:mm")})})},any:function(){return!!this.messages.length}},this.$scope.messages.format(this.$scope.comment.messages)},t.prototype.initReplyData=function(){var e=this.$scope.comment.lastReplyingMessage;this.$scope.reply={message:e,opened:!!e,replying:!!e}},t.prototype.getSlackAppTipConfig=function(){var e=this;return{type:h.l.TipType.SlackApp,text:'<b>Quick Tip:</b> How to receive mentions in responses instantly? <span class="rtb-link rtb-link--primary">Get our Slack App</span>',icon:n(4975),onClick:function(){h.l.clickTip(h.l.TipType.SlackApp,h.l.TipContent.CommentWidget),Object(M.a)(!1)},onClose:function(){h.l.closeTip(h.l.TipType.SlackApp,h.l.TipContent.CommentWidget),e.$scope.tip.visible=!1}}},t.prototype.tryShowReplyTips=function(){return Object(o.b)(this,void 0,void 0,function(){return Object(o.e)(this,function(e){switch(e.label){case 0:return this.$scope.tip.visible=!1,[4,this.tryToShowInviteTriggerTip()];case 1:return e.sent()?[2]:[4,this.tryToShowFirstReplyTip()];case 2:return e.sent()?[2]:[4,this.tryToShowFirstMentionTip()];case 3:return e.sent()?[2]:(this.tryToShowFirstAutoFollowTip(this.$scope.comment),[2])}})})},t.prototype.tryToShowFirstReplyTip=function(){return Object(o.b)(this,void 0,Promise,function(){return Object(o.e)(this,function(e){switch(e.label){case 0:return[4,this.checkShouldShowSlackTip(b.a.COMMENT_CREATED)];case 1:return e.sent()?(this.showSlackTip(b.a.COMMENT_CREATED),[2,!0]):[2,!1]}})})},t.prototype.tryToShowInviteTriggerTip=function(){return Object(o.b)(this,void 0,Promise,function(){return Object(o.e)(this,function(e){switch(e.label){case 0:return[4,this.checkShouldShowInviteTriggerTip()];case 1:return e.sent()?(this.showInviteTriggerTip(),[2,!0]):[2,!1]}})})},t.prototype.tryToShowFirstMentionTip=function(){return Object(o.b)(this,void 0,void 0,function(){var e,t,n;return Object(o.e)(this,function(o){switch(o.label){case 0:return e=!1,[4,this.checkShouldShowSlackTip(b.a.COMMENT_WITH_MENTION_CREATED)];case 1:return o.sent()&&(t=this.$scope.reply.controller,(n=t.getParseResult())&&n.hasMentions&&(this.showSlackTip(b.a.COMMENT_WITH_MENTION_CREATED),e=!0)),[2,e]}})})},t.prototype.tryToShowFirstUnreadThreadTip=function(e){return Object(o.b)(this,void 0,void 0,function(){var t;return Object(o.e)(this,function(n){switch(n.label){case 0:return[4,this.checkShouldShowSlackTip(b.a.UNREAD_THREAD_OPENED)];case 1:return n.sent()&&(t=x().userInfo.id,Object(y.c)(e.openTime,e.messages,t)>0&&this.showSlackTip(b.a.UNREAD_THREAD_OPENED)),[2]}})})},t.prototype.tryToShowFirstAutoFollowTip=function(e){return Object(o.b)(this,void 0,void 0,function(){var t,i=this;return Object(o.e)(this,function(o){return this.checkCanShowTip(b.a.EXISTING_THREAD_REPLY)&&e.creatorId.toString()!==x().userInfo.id&&(t={type:h.l.TipType.FollowThread,text:'You\'re following this thread and will get notified about new replies. \n\t\t\t\t\t\t<a class="rtb-link rtb-link--primary" href="https://help.miro.com/hc/en-us/articles/360017730873-Comments" target="_blank">Learn more</a>',icon:n(1910),iconClass:"comment-message__picture--small",onClick:function(){h.l.clickTip(h.l.TipType.FollowThread,h.l.TipContent.CommentWidget)},onClose:function(){h.l.closeTip(h.l.TipType.FollowThread,h.l.TipContent.CommentWidget),i.$scope.tip.visible=!1}},this.showTip(t,b.a.EXISTING_THREAD_REPLY)),[2]})})},t.prototype.checkShouldShowSlackTip=function(e){return Object(o.b)(this,void 0,Promise,function(){var t;return Object(o.e)(this,function(n){switch(n.label){case 0:return(t=this.checkCanShowTip(e))?[4,w.a.integrations.get()]:[3,4];case 1:return n.sent().SLACK?(x().achievements.open(e),t=!1,[3,4]):[3,2];case 2:return[4,w.a.boards.selectById(Object(E.a)().currentBoard.boardInfo.id).get({fields:"account{usersNumber}"}).then(function(e){e.account.usersNumber<2&&(t=!1)}).catch(function(){return t=!1})];case 3:n.sent(),n.label=4;case 4:return[2,t]}})})},t.prototype.showSlackTip=function(e){var t=this.getSlackAppTipConfig();this.showTip(t,e),h.l.showTip(t.type,h.l.TipContent.CommentWidget)},t.prototype.checkShouldShowInviteTriggerTip=function(){return Object(o.b)(this,void 0,Promise,function(){return Object(o.e)(this,function(e){switch(e.label){case 0:return this.checkCanShowTip(b.a.INVITE_TO_ACCOUNT_COMMENT_TIP)?[4,Object(j.b)({showWithTutorials:!0,showAfterTimeGap:!1})]:[2,!1];case 1:return[2,e.sent()]}})})},t.prototype.getInviteTriggerTipConfig=function(){var e=this;return{type:h.l.TipType.InviteTrigger,text:'<span class="rtb-link rtb-link--primary">Invite teammates</span> to discuss ideas and work on your board together.',icon:n(2217),onClick:function(){Object(R.a)(function(){return Object(k.b)()}).then(function(e){return e.showShareBoardModal(Object(E.a)().currentBoard.boardInfo,"comment")}),h.gd("comment","invite",Object(E.a)().currentBoard.boardInfo.account.id,Object(E.a)().currentBoard.boardInfo.id)},onClose:function(){e.$scope.tip.visible=!1,h.gd("comment","cross",Object(E.a)().currentBoard.boardInfo.account.id,Object(E.a)().currentBoard.boardInfo.id)}}},t.prototype.showInviteTriggerTip=function(){var e=this.getInviteTriggerTipConfig();this.showTip(e,b.a.INVITE_TO_ACCOUNT_COMMENT_TIP),h.Xi("comment",Object(E.a)().currentBoard.boardInfo.account.id,Object(E.a)().currentBoard.boardInfo.id)},t.prototype.checkCanShowTip=function(e){return Object(O.a)().getMode()!==S.a.EMBED&&i.desktop&&x().userType===a.a.REGULAR&&!x().achievements.isOpened(e)&&Object(v.a)(T.a.lastCommentWidgetTipCloseDate)},t.prototype.showTip=function(e,t){this.$scope.tip=e,this.$scope.tip.visible=!0,this.$scope.safeDigest(),this.$scope.scrollToMessage(),Object(v.E)(T.a.lastCommentWidgetTipCloseDate),x().achievements.open(t)},t.$inject=["$scope","$element","$timeout"],t}();t.a=U}).call(this,n(36))},2216:function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(122),i=n(33),s=n(35),r=n(264),a=n(399),c=n(223);function l(e){return{isAllowed:Object(o.a)().allowFollow,isFollowed:function(){return Object(i.wb)(e.subscriptionMode)},click:function(){var t=!Object(i.wb)(e.subscriptionMode);e.changeSubscriptionMode(t),t?(Object(s.a)().show("You'll get notified about new replies in this thread"),setTimeout(function(){Object(r.a)(a.a(c.a.FEED_THREAD_FOLLOWED))},5e3)):Object(s.a)().show({text:"You won't get notified about new replies in this thread",actionText:"Undo",actionCallback:function(){e.changeSubscriptionMode(!0)}})}}}},2217:function(e,t){e.exports="#application__share-to-other"},4970:function(e,t,n){"use strict";var o=n(21),i=n(4971),s=n(46),r=n(44),a=n(62),c=n(67),l=n(486);t.a=function(e){return void 0===e&&(e={}),Object(a.a)(),Object(c.a)(),Object(l.a)(),n(4972),s.a(r.a.LOGIN_OR_ENTER_NAME,i.a,n(4974),Object(o.a)({enableSubmitByEnter:!0},e))}},4971:function(e,t,n){"use strict";(function(e){var o=n(21),i=n(48),s=n(52),r=n(34),a=n(26),c=n(39),l=n(22),m=n(53),u=n(92),p=n(32),d=r.b(),h=c.b(),g=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.rememberMe=!0,e.name="",e.waiting=!1,e.isGuest=d().userType===u.a.GUEST,e}return Object(o.d)(n,t),n.prototype.login=function(){a.zd(),s.n(h().getBoardId())},n.prototype.submit=function(){var n=this;""!=this.name.trim()&&(this.waiting=!0,this.isGuest?(d().registerAsTemporaryUser(this.name,this.rememberMe).then(function(){var t=e.Deferred();return h().disconnect(),h().reconnect(),l.onCanvasLoaded.addOnce(t.resolve),t.promise()}).then(function(){return t.prototype.submit.call(n)}).catch(function(){return t.prototype.cancel.call(n)}),a.y()):d().userInfo.temporary&&p.a.profile.set({name:this.name}).then(function(){return d().updateProfile()}).then(function(){return t.prototype.submit.call(n)}).catch(function(){return t.prototype.cancel.call(n)}))},Object(o.c)([Object(m.a)("LoginOrEnterNameMC.submit")],n.prototype,"submit",null),n}(i.b);t.a=g}).call(this,n(36))},4972:function(e,t,n){var o=n(4973);"string"===typeof o&&(o=[[e.i,o,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(24)(o,i);o.locals&&(e.exports=o.locals)},4973:function(e,t,n){(e.exports=n(23)(!1)).push([e.i,".login-or-enter-name-modal .enter-name {\n  width: 100%;\n  padding-left: 34px;\n}\n.login-or-enter-name-modal .icon {\n  float: left;\n  margin: -32px 0 0 10px;\n  opacity: 0.2;\n}\n",""])},4974:function(e,t){e.exports='<rtb-modal class="rtb-modal--center rtb-modal--medium login-or-enter-name-modal">\n    <rtb-modal-close-button hm-tap="modal.cancel()"></rtb-modal-close-button>\n    <div class="rtb-modal-container__content rtb-modal-content">\n        <div class="rtb-modal-content__header rtb-modal-header">\n            Please <span class="rtb-link rtb-link--primary" hm-tap="modal.login()">log in</span> or enter your name\n        </div>\n        <div class="rtb-modal-content__body rtb-modal-body">\n            <div class="rtb-modal-body__row">\n                <input class="rtb-input rtb-input--primary enter-name focus-target" placeholder="Enter name" ng-model="modal.name">\n                <icon icon-name="\'application--profile\'"></icon>\n            </div>\n            <div class="rtb-modal-body__row">\n                <rtb-checkbox\n                    label="\'Remember me\'"\n                    name="\'rememberMeAfterRegCb\'"\n                    checked="modal.rememberMe"\n                    ng-if="modal.isGuest"\n                ></rtb-checkbox>\n            </div>\n        </div>\n        <div class="rtb-modal-content__actions rtb-modal-actions">\n            <button class="rtb-btn rtb-btn--primary rtb-btn--medium"\n                    ng-disabled="modal.waiting || modal.name.trim() == \'\'"\n                    hm-tap="modal.submit()">Done\n            </button>\n        </div>\n    </div>\n</rtb-modal>'},4975:function(e,t){e.exports="#application__slack-18"}}]);
//# sourceMappingURL=cmn~BoaUI.des~BoaUI.mob~Not.3164b5e6d0f0d1cd24fe.js.map